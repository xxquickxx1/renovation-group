YUI.add("flickr-photos-comments-deleteComment-deletor",function(e,t){"use strict";function n(n,r){var i={};return i.comment_id=n,r.callAPI("flickr.photos.comments.deleteComment",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-comments-deleteComment"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-comments-addComment"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-photos-comments-editComment"].run({commentId:t,content:n.content.newVal,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")},this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-comments-deleteComment"].run(t,this.appContext)}},attributes:{author:{isModel:!0},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,n){return e.moment.unix(this.getValue(n,"date"))}},permalink:{},content:{},contentSecure:{},contentRaw:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-photos-comments-addComment-creator","flickr-photos-comments-editComment-updater","flickr-photos-comments-deleteComment-deletor"]});
YUI.add("photo-comments-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{comments:{isListProxy:!0,rangeFetch:{listFetcher:e.ListFetchers["flickr-photos-comments-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-comments-getList-fetcher"]});
YUI.add("flickr-photos-comments-getList-fetcher",function(e,t){"use strict";function n(t){var n={photo_id:t.id,offset:t.offset||0,limit:t.limit||4,sort:t.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:!0,use_text_for_links:1,secure_image_embeds:1};return t.photosInCommentsEnabled&&(n.bbml_need_all_photo_sizes=!0,n.primary_photo_longest_dimension=e.config.flickr.comment_image_max_width),n}function r(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.exists(t.author)?s.proxy(t.author):s.add(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},o.push(i.exists(t.id)?i.proxy(t.id):i.add(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.comments.getList",this._processParams(n)),r.getModelRegistry("photo-comments-models"),r.getModelRegistry("comment-models"),r.getModelRegistry("person-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("comments-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.appContext.flipper.isFlipped("comments-chronological")?(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:3,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200):(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:4,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:10),this.isTooltipComments=e.isTooltipComments?!0:!1,this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.textAreaMaxHeight=180,this.textAreaMinHeight=35,this.textAreaUserSetHeight=this.textAreaMinHeight,this.noIcons=e.noIcons,this.postingComment=!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(n){t.photoEngagement=n;var r=t.photoEngagement.getValue("commentCount"),i=e.config.win.location.hash,s=/#comment{1}/g;i&&s.test(i)?(t.initiallyShowingCount=r,t.currentlyShowingCount=r):r>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=r,t.currentlyShowingCount=r)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.Promise.all(n)},buildContainer:function(){var t,n=this.photoModel.getValue("url"),r=this.person?this.person.toJSON():null,i=this.get("comments"),s=this.appContext.flipper.isFlipped("comments-chronological")?"chronological":"reverse-chronological",o=this.calculateShowMoreCount(),u=o===1?"1 more comment":o+" more comments",a,f=e.config.win.location.hash,l=/#comment{1}/g;this.appContext.flipper.isFlipped("comments-chronological")&&(i=i.reverse()),this.isTooltipComments&&(this.ellipsis=this.intlMessage({intlName:"comments.SEE_MORE_LINK",photoUrl:n}));for(a=0;a<i.length;a++)i[a]=i[a].toJSON?i[a].toJSON():i[a],i[a].isSignedIn=this.appContext.getViewer().signedIn,i[a].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),i[a].canCommentBeDeleted=this.canCommentBeDeleted(i[a].author.nsid),i[a].commentBelongsToViewer=this.commentBelongsToViewer(i[a].author.nsid),i[a].enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i[a].canComment=this.photoModel.getValue("canComment"),i[a].isTooltipComment=this.isTooltipComments,i[a].ellipsis=this.ellipsis,i[a].noIcons=this.noIcons;return t=this.templates("comments-view")({user:r,comments:i,showMore:this.calculateShowMoreCount()>0?!0:!1,showMoreCount:this.calculateShowMoreCount(),showMoreString:u,canComment:this.photoModel.getValue("canComment"),tutorialMode:!0,isTooltipComments:this.isTooltipComments,photoUrl:n,commentsOrder:s,commentsChronological:this.appContext.flipper.isFlipped("comments-chronological"),photosInCommentsClass:this.appContext.flipper.isFlipped("photos-in-comments")?"photosInComments":""}),this.setContainerHTML(t),this.retinafyCommentImages(),f&&l.test(f)&&this.jumpToPermalinkedComment(),this},buildErrorContainer:function(){this.setContainerHTML(this.templates("comments-view")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container").one(".new-comment-text");return t.get("container").one(".comments-more")&&t.registerEventHandler(t.get("container").one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),"blur:comment":t.handleCommentBlur.bind(t),"focus:comment":t.handleCommentFocus.bind(t),"mouseup:comment":t.handleCommentMouseUp.bind(t),"mouseleave:comment":t.handleCommentMouseLeave.bind(t),"mousedown:comment":t.handleCommentMouseDown.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t)})}),n&&n.setStyles({minHeight:this.textAreaMinHeight+"px",maxHeight:this.textAreaMaxHeight+"px"}),this},postComment:function(t){var n=this,r,i,s,o,u=this.photoEngagement.getValue("commentCount");n.fire("addingNewComment");if(e.Lang.trim(t)===""){this.onError("An empty comment box? That won't work!"),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")}).then(function(t){i=t.toJSON(),i.isSignedIn=n.appContext.getViewer().signedIn,i.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),i.enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i.canCommentBeDeleted=!0,i.commentBelongsToViewer=!0,i.canComment=!0,n.get("container").one(".new-comment-text").set("value","").setStyle("height",n.textAreaMinHeight+"px"),r=e.Node.create(n.templates("comment")(i)).setStyle("opacity","0.1"),u>0?n.appContext.flipper.isFlipped("comments-chronological")?n.get("container").one(".comments").append(r).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):n.get("container").one(".comments").prepend(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(n.appContext.flipper.isFlipped("comments-chronological"
)?n.get("container").one(".comments-holder").prepend("<ul class='comments'></ul>"):n.get("container").one(".comments-holder").append("<ul class='comments'></ul>"),n.get("container").one(".comments").append(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),n.retinafyCommentImages(),s=n.photoComments.getValue("comments").prependToList(t),o=n.photoEngagement.getValue("commentCount")+1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount++,n.fire("newCommentAdded"),n.postingComment=!1},function(e){e.code===409?n.onError("Slow down, partner! To protect the Flickr community against spam and spammy behavior we place a few restrictions on commenting."):e.code===8?n.onError("An empty comment box? That won't work!"):n.onError("We couldn't post your comment."),n.postingComment=!1}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,n=this.get("container"),r="",i=n.one(".comments-more"),s;i.one("a").set("text","Loading"),i.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount(),photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){var o;t.appContext.flipper.isFlipped("comments-chronological")&&(e=e.reverse());for(o=0;o<e.length;o++)s=e[o].toJSON(),s.isSignedIn=t.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),s.canCommentBeDeleted=t.canCommentBeDeleted(s.author.nsid),s.commentBelongsToViewer=t.commentBelongsToViewer(s.author.nsid),s.enabledEditableComments=t.appContext.flipper.isFlipped("enable-editable-comments"),s.canComment=t.photoModel.getValue("canComment"),r+=t.templates("comment")(s);t.appContext.flipper.isFlipped("comments-chronological")?n.one(".comments").prepend(r):n.one(".comments").append(r),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(i.one("a").set("text",t.calculateShowMoreCount()+" more"),i.removeClass("is-loading")):i.remove()},function(e){t.onError("We couldn't get more comments.")}).then(null,function(e){t.appContext.error(e.message),t.appContext.error(e.stack)})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()?!0:!1},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid?!0:!1},jumpToPermalinkedComment:function(){var t=e.config.win.location.hash,n=this.get("container"),r,i=this,s;r=n.one(t),r?(r.scrollIntoView(!0),r.addClass("permalinked-comment")):i.fire("viewEvent","getDialogOffset",function(t){s=e.Views.dialog.getNewInstance("dialog-alert",{content:"We were unable to find the specified comment in the Photo.",attrs:{title:"Oops!",level:"warning",confirmLabel:"OK"},parent:i,offsetLeft:t}),s.show()})},retinafyCommentImages:function(){if(this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){var t=this,n=this.get("container").one(".new-comment-text"),r=n.get("value"),i=this.get("container").one(".false-comment-content"),s;if(e.charCode===13&&!e.altKey&&!e.shiftKey&&!this.postingComment){this.textAreaUserSetHeight=this.textAreaMinHeight,e.preventDefault(),this.postingComment=!0,this.postComment(r);return}setTimeout(function(){i.set("value",n.get("value")),s=i._node.scrollHeight<t.textAreaMinHeight?t.textAreaMinHeight:i._node.scrollHeight,s=i._node.scrollHeight>t.textAreaMaxHeight?t.textAreaMaxHeight:s,s=t.textAreaUserSetHeight>i._node.scrollHeight?t.textAreaUserSetHeight:s,n.setStyle("height",s+"px")},10)},handleCommentMouseDown:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=t.getComputedStyle("height"),isNaN(n)||(this.textAreaUserSetHeight=this.textAreaUserSetHeight!==n?n:this.textAreaUserSetHeight))},handleCommentMouseUp:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=parseInt(t.getComputedStyle("height"),10),!isNaN(n)&&this.textAreaUserSetHeight!==n&&(this.textAreaUserSetHeight=n>this.textAreaMaxHeight?this.textAreaMaxHeight:n,t.setStyle("height",this.textAreaUserSetHeight+"px")))},handleCommentMouseLeave:function(t){e.config.win.clearTimeout(this.textAreaUserMouseLeave),this.textAreaUserMouseLeave=setTimeout(e.bind(function(){var e=this.get("container").one(".new-comment-text"),t=0;e&&(t=parseInt(e.getComputedStyle("height"),10),isNaN(t)||(this.textAreaUserSetHeight=t<this.textAreaMinHeight?this.textAreaMinHeight:t,this.textAreaUserSetHeight=t>this.textAreaMaxHeight?this.textAreaMaxHeight:t))},this),100)},handleCommentBlur:function(e){var t=this.get("container").one("textarea");t.getData("notutorial")&&t.set("placeholder",t.getData("notutorial"))},handleCommentFocus:function(e){var t=this.get("container").one("textarea");t.getData("tutorial")&&t.set("placeholder",t.getData("tutorial"))},handleReplyClick:function(t){t.preventDefault();var n=this.get("container").one("textarea"),r=n.get("value"),i="",s=n.getDOMNode(),o;r.length>0&&(i+=r+" "),i+="["+e.url("/photos/"+t.target.getAttribute("data-pathalias"))+"] ",s.setSelectionRange?(s.focus(),s.setSelectionRange(s.value.length,s.value.length)):s.createTextRange&&(o=s.createTextRange(),o.collapse(!0),o.moveEnd("character",s.value.length),o.moveStart("character",s.value.length),o.select()),n.focus()
,n.set("value",i),s.scrollTop=s.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute("data-id"),s,o,u,a=this.get("container").one(".false-comment-content"),f;if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),n.appContext.flipper.isFlipped("photos-in-comments")?r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"):r.append("<textarea>"+t.getValue("content")+"</textarea>"),s=r.one("textarea"),a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px"),s.select(),s.on("keydown",function(l){setTimeout(function(){a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px")},10);if(l.charCode===13&&!l.altKey&&!l.shiftKey&&!n.postingEditedComment){l.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError("An empty comment box? That won't work!");return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=n.appContext.flipper.isFlipped("enable-editable-comments"),u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),u.isTooltipComment=n.isTooltipComments,u.ellipsis=n.ellipsis,o=e.Node.create(n.templates("comment")(u)),r.replace(o),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var n=this,r,i,s=t.target.ancestor(".comment"),o=t.target.getAttribute("data-id"),u;r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Delete Comment",icon:"ui-icon-modal-warning",content:"Are you sure you want to delete this comment?",confirmButtonLabel:"Delete"}),r.render(),r.activate(),i=r.get("container"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",function(){n.commentingDialog.close(),n.commentingDialog.destroy(),n.appContext.modelRegistries["comment-models"].remoteDelete(o).then(function(){n.photoComments.getValue("comments").removeFromList(o),u=n.photoEngagement.getValue("commentCount")-1,n.photoEngagement.setValue("commentCount",u),n.currentlyShowingCount--,n.fire("commentDeleted"),s.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){s.remove(),u===0&&n.get("container").one(".comments").remove()})},function(e){n.onError("We couldn't delete your comment.")}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})})),this.fire("subviewViewEvent","getDialogOffset",function(t){n.commentingDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:n.appContext,offsetLeft:t}),n.commentingDialog.show()})},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getNewInstance("dialog-alert",{content:t,attrs:{title:"Error",level:"warning",confirmLabel:"OK"},parent:n,offsetLeft:r});i.show()})}})},"@VERSION@",{requires:["dialog","flickr-view","moment","comments-css","hermes-template-comments","hermes-template-comment","hermes-template-comments-view","url"],langBundles:["comments","relative-dates"],optional:["photo-comments-models"]});
YUI.add("hermes-lang-comments",function(e,t){e.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>']})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-relative-dates",function(e,t){e.Intl.add("hermes/relative-dates","en-US",{SECOND_LONG:["1 second"],SECONDS_LONG:["${time}"," seconds"],MINUTE_LONG:["1 min"],MINUTES_LONG:["${time}"," mins"],HOUR_LONG:["1 hour"],HOURS_LONG:["${time}"," hours"],DAY_LONG:["1 day"],DAYS_LONG:["${time}"," days"],MONTH_LONG:["1 month"],MONTHS_LONG:["${time}"," months"],YEAR_LONG:["1 year"],YEARS_LONG:["${time}"," years"],SECOND_SHORT:["1s"],SECONDS_SHORT:["${time}","s"],MINUTE_SHORT:["1m"],MINUTES_SHORT:["${time}","m"],HOUR_SHORT:["1h"],HOURS_SHORT:["${time}","h"],DAY_SHORT:["1d"],DAYS_SHORT:["${time}","d"],MONTH_SHORT:["1mo"],MONTHS_SHORT:["${time}","mo"],YEAR_SHORT:["1y"],YEARS_SHORT:["${time}","y"],SECOND_LONG_FUTURE:["in 1 second"],SECONDS_LONG_FUTURE:["in ","${time}"," seconds"],MINUTE_LONG_FUTURE:["in 1 min"],MINUTES_LONG_FUTURE:["in ","${time}"," mins"],HOUR_LONG_FUTURE:["in 1 hour"],HOURS_LONG_FUTURE:["in ","${time}"," hours"],DAY_LONG_FUTURE:["in 1 day"],DAYS_LONG_FUTURE:["in ","${time}"," days"],MONTH_LONG_FUTURE:["in 1 month"],MONTHS_LONG_FUTURE:["in ","${time}"," months"],YEAR_LONG_FUTURE:["in 1 year"],YEARS_LONG_FUTURE:["in ","${time}"," years"],FUTURE_SHORT_FUTURE:["in ","${time}"],SECOND_SHORT_FUTURE:["in 1s"],SECONDS_SHORT_FUTURE:["in ","${time}","s"],MINUTE_SHORT_FUTURE:["in 1m"],MINUTES_SHORT_FUTURE:["in ","${time}","m"],HOUR_SHORT_FUTURE:["in 1h"],HOURS_SHORT_FUTURE:["in ","${time}","h"],DAY_SHORT_FUTURE:["in 1d"],DAYS_SHORT_FUTURE:["in ","${time}","d"],MONTH_SHORT_FUTURE:["in 1mo"],MONTHS_SHORT_FUTURE:["in ","${time}","mo"],YEAR_SHORT_FUTURE:["in 1y"],YEARS_SHORT_FUTURE:["in ","${time}","y"],SECOND_LONG_PAST:["1 second ago"],SECONDS_LONG_PAST:["${time}"," seconds ago"],MINUTE_LONG_PAST:["1 min ago"],MINUTES_LONG_PAST:["${time}"," mins ago"],HOUR_LONG_PAST:["1 hour ago"],HOURS_LONG_PAST:["${time}"," hours ago"],DAY_LONG_PAST:["1 day ago"],DAYS_LONG_PAST:["${time}"," days ago"],MONTH_LONG_PAST:["1 month ago"],MONTHS_LONG_PAST:["${time}"," months ago"],YEAR_LONG_PAST:["1 year ago"],YEARS_LONG_PAST:["${time}"," years ago"],SECOND_SHORT_PAST:["1s ago"],SECONDS_SHORT_PAST:["${time}","s ago"],MINUTE_SHORT_PAST:["1m ago"],MINUTES_SHORT_PAST:["${time}","m ago"],HOUR_SHORT_PAST:["1h ago"],HOURS_SHORT_PAST:["${time}","h ago"],DAY_SHORT_PAST:["1d ago"],DAYS_SHORT_PAST:["${time}","d ago"],MONTH_SHORT_PAST:["1mo ago"],MONTHS_SHORT_PAST:["${time}","mo ago"],YEAR_SHORT_PAST:["1y ago"],YEARS_SHORT_PAST:["${time}","y ago"],NO_DATE:["-"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-widget-comment",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-display-widget-comment">\n	<span class="ui-link" data-action="getcomments">\n		<span class="ui-icon-comments"></span>\n		<span class="comment-counter">',(o=n.commentCount)?o=o.call(t,{hash:{},data:i}):(o=t.commentCount,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n	</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/widget-comment",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("display-widget-comment",function(e){"use strict";var t,n=this.name,r=e.flutil;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(t){this.options=r.extend({templateName:"widget-comment"},t),this.set("photo",this.options.photo),this.CommentsView=e.namespace("Views")["comments-view"]},initialize:function(){var e=this;this.appContext.getModel("photo-engagement-models",this.get("photo").id).then(function(t){e.set("photo-engagement",t),e.fire("activated"),e.render()})},showCommentDialog:function(t){var n=this,r=this.get("photo"),i=new this.CommentsView({appContext:this.appContext,isTooltipComments:!0,photoId:r.id,noIcons:!0}),s,o;t.preventDefault(),this.appContext.getViewer().signedIn?(this.target=this.target||t.target.hasClass("ui-link")?t.target:t.target.ancestor(".ui-link"),this.target&&(e.rapidTracker.beacon(this.name,"commentDisplayItemButtonClick"),this.target.addClass("ui-state-fetching"),i.initialize().then(function(t){s=n.target.ancestor(".ui-display-wrapper"),o=e.Views.dialog.getInstance("dialog-tooltip",{content:i.get("container"),appendCurtainTo:n.get("container").ancestor(".ui-display-wrapper").get("parentNode"),anchorTo:n.target,positioning:!0,constraints:{top:90},parent:n,arrow:!0,id:n.getId()}),n.setEnvironmentToShowInlineComment(s,o),o.on("hide",function(){n.cleanEnvironmentAfterShowingInlineComment(s)}),n.convertCommentsIntoInlineComments(i),i.on("addingNewComment",function(){e.Views.dialog.close(),n.target.addClass("ui-state-fetching")}),i.on("newCommentAdded",function(){n.target.removeClass("ui-state-fetching"),n.updateCounter(),n.convertCommentsIntoInlineComments(i)}),i.on("commentEdited",function(){n.convertCommentsIntoInlineComments(i)}),i.on("commentDeleted",function(){n.updateCounter()}),o.show(),i.render(),n.target.removeClass("ui-state-fetching"),i.activate()}))):n.promptTheUserToSignIn(r.id)},promptTheUserToSignIn:function(t){var n,r,i,s,o,u;i=this.intlMessage({intlName:"grease.YAY"}),s=this.intlMessage({intlName:"grease.JOIN_TO_COMMENT_LINK",joinLink:"/signup/"}),u=this.intlMessage({intlName:"grease.SIGN_UP_TXT"}),o=this.intlMessage({intlName:"grease.SIGN_IN_TXT"}),n=new e.Views["confirmation-dialog-view"]({title:i,icon:"ui-icon-big-comment",content:s,confirmButtonClass:"ui-button-minimal",confirmButtonLabel:o,showAuxiliaryButton:!0,auxiliaryButtonLabel:u}),n.appContext=this.appContext,n.render(),n.activate(),n.on("auxiliaryClick",function(){window.location=e.url("/signup")}),r=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),r.show(),n.registerEventHandler(n.get("container").one(".ui-dialog-button-confirm").on("click",function(){r.close(),r.destroy(),e.SigninHelper.addPendingComment({id:t})}))},updateCounter:function(){this.render()},convertCommentsIntoInlineComments:function(e){var t=e.get("container");t.all(".comment-content a").each(function(e){e.setAttribute("data-action","follow")}),t.all(".comment-content img").each(function(e){e.remove()})},setEnvironmentToShowInlineComment:function(e,t){var n=e.one(".ui-display-shield");e.addClass("ui-state-inline-commenting"),this.shieldClickSubscription=n.on("click",function(e){e.halt(),t.close()})},cleanEnvironmentAfterShowingInlineComment:function(e){e.removeClass("ui-state-inline-commenting"),this.shieldClickSubscription&&this.shieldClickSubscription.detach(),this.shieldClickSubscription=null},activate:function(){this.attachEvents({":getcomments":this.showCommentDialog})},render:function(){var e=this.get("photo-engagement"),t=e.getValue("commentCount");t?t>99?t="99+":t=t.toString():t="",this.buildContainer({commentCount:t})}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","dialog","display-item","comments-view","dialog","signin-helper","display-widget-comment-css","confirmation-dialog-view","hermes-template-widget-comment","url"],langBundles:["grease"]});
YUI.add("hermes-template-widget-meta",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="ui-display-widget-meta">\n	<span class="title">\n		<a href="',(o=n.photoUrl)?o=o.call(t,{hash:{},data:i}):(o=t.photoUrl,o=typeof o===a?o.apply(t):o),s+=f(o)+'" title="',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'">',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'</a>\n	</span>\n	<span class="attribution">\n		',u={hash:{intlName:"widget-meta.BY_LINK",userUrl:t.userUrl,displayName:t.displayName,displayName:t.displayName},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):l.call(t,"intlHTMLMessage",u)))+"\n	</span>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/widget-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("display-widget-meta",function(e){"use strict";var t,n=this.name,r=e.flutil;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(e){this.options=r.extend({templateName:"widget-meta"},e),this.photo=this.options.photo},initialize:function(){var e=this.photo,t=e.getValue("owner"),n,r;e.getValue("isOwner")?n=this.intlMessage({intlName:"widget-meta.YOU"}):n=t.getValue("displayname"),r={title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),photoUrl:e.getValue("url"),displayName:n,userUrl:t.getValue("url")},this.render(r)},activate:function(){},render:function(e){this.buildContainer(e)}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","display-item","display-widget-meta-css","hermes-template-widget-meta"],langBundles:["widget-meta","default"]});
YUI.add("hermes-lang-widget-meta",function(e,t){e.Intl.add("hermes/widget-meta","en-US",{BY_LINK:['by <a href="',"${userUrl}",'" title="',"${displayName}",'">',"${displayName}","</a>"],YOU:["YOU!"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-default",function(e,t){e.Intl.add("hermes/default","en-US",{UNTITLED:["Untitled"]})},"@VERSION@",{requires:["intl"]});
YUI.add("display-item-tile",function(e){"use strict";var t,n=this.name,r=e.flutil,i=e.Flog;t=e.Base.create(n,e.Views["display-item"],[],{langBundles:this.details.langBundles,initializer:function(t){this.options=r.extend({templateName:"display-item-tile"},t),this.subviews={},this.photo=null,this.assetManager=null,this.bleedWidth=0,this.bleedHeight=0,this.frameWidth=0,this.frameHeight=0,this._style={},this._el={},this.photo=this.options.photo||null;if(this.options.disableFave||this.options.disableMeta||this.options.disableComments)this.subviewConfig=[],this.options.disableFave||this.subviewConfig.push("display-widget-fave"),this.options.disableMeta||this.subviewConfig.push("display-widget-meta"),this.options.disableComments||this.subviewConfig.push("display-widget-comment");return this.photo&&(this.assetManager=new e.AssetManager(this.photo,{maxUpSampleAmount:.05,container:this.get("container"),selector:".ui-display-image",normalizeAspect:!0,noSquares:t.noSquares||!1})),this.paft=t.paft,this},subviewConfig:["display-widget-fave","display-widget-meta","display-widget-comment"],initialize:function(){if(this.is("rendering")||this.is("rendered"))return;this.setupSubviews().then(this.render.bind(this)).then(null,function(e){i.error("ERROR IN "+n,e.stack||e)})},activate:function(){var e=this,t;if(this.is("activating")||this.is("activated"))return;this.options.disableMeta&&this.get("container").addClass("no-meta"),this.get("container").on("click",function(e){var t=2;(e.ctrlKey||e.metaKey||e.which===t)&&e.stopPropagation()}),this.options.photoDeleteRights&&(this.options.photoDeleteRights.allPhotos?t=!0:this.options.photoDeleteRights.ownPhotos&&this.photo.getValue("isOwner")&&(t=!0),t&&(this.get("container").one(".ui-delete-button").addClass("enabled"),this.attachEvents({":delete":function(t){e.fire("deletePhoto",{photo:e.photo})}}))),this.activateSubviews(),this.fire("activated")},render:function(){this.buildContainer({paft:this.paft,photo:this.getPhotoJSON()}),this.resetStyles()},getPhotoJSON:function(){var e=this.photo.toJSON();return e.url+=this.options.context||"",e.current=this.assetManager.toJSON(),e},resize:function(e,t){this.assetManager.setSize(e,t),this.bleedWidth=this.frameWidth=this.assetManager.naturalWidth,this.bleedHeight=this.frameHeight=this.assetManager.naturalHeight,this.fitToSize(this.assetManager.width,this.assetManager.height),this.fire("resize",{width:e||null,height:t||null})},fitToSize:function(e,t){var n={};n.overflow="hidden",n.width=this.frameWidth=e,n.width+="px",n.height=this.frameHeight=t,n.height+="px",this.setStyles("displayMask",n)},hibernate:function(){var e;if(this.is("hibernating"))return;this.is("hibernating",!0),e=this.get("container"),this.assetManager&&this.assetManager.cancel(),this.ancestor=this.ancestor||e.ancestor(),this.ancestor&&this.ancestor.addClass("ui-state-hibernating")},wake:function(){var e;if(!this.is("hibernating"))return;this.is("hibernating",!1),e=this.get("container"),this.ancestor=this.ancestor||e.ancestor(),this.ancestor&&this.ancestor.removeClass("ui-state-hibernating"),this.assetManager.load()},remove:function(){var e=this.get("container");e.addClass("no-meta"),e.addClass("deleted")},destructor:function(){this._style=null,this._el=null,this.assetManager=null}}),e.namespace("Views")[n]=t},"@VERSION@",{requires:["flutil","flog","display-item","hermes-template-display-item-tile","display-item-tile-css"],optional:["display-widget-fave","display-widget-comment","display-widget-meta"],langBundles:["groups"]});
YUI.add("hermes-lang-groups",function(e,t){e.Intl.add("hermes/groups","en-US",{POST_THRESHOLD_EVER:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool."],POST_THRESHOLD_DAY:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each day."],POST_THRESHOLD_MONTH:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each month."],POST_THRESHOLD_WEEK:["Members can post ",{type:"plural",valueName:"count",options:{one:"<b>${#}</b> thing",other:"<b>${#}</b> things"}}," to the pool each week."],ACCEPTED_CONTENT_TYPES:["Accepted content types:"],ACCEPTED_SAFETY_LEVELS:["Accepted safety levels:"],PHOTOS:["Photos"],VIDEOS:["Videos"],IMAGES:["Images"],SCREENSHOTS:["Screenshots"],ART:["Art"],SAFE:["Safe"],MODERATE:["Moderate"],RESTRICTED:["Restricted"],SEE_ALL_DISCUSSIONS:["See all discussions"],DISCUSSION_TITLE:["Title"],DISCUSSION_AUTHOR:["Author"],DISCUSSION_REPLIES:["Replies"],DISCUSSION_LAST_POST:["Latest Post"],DISCUSSION_LAST_REPLIER:["Last Replier"],NO_DISCUSSIONS:["Be the first to start a group discussion!"],BE_THE_FIRST:["Be the first to add a photo to the group!"],BE_THE_FIRST_JOIN:["Help get this group started: click the join button above!"],BE_THE_FIRST_SIGN_IN:["Help get this group started: sign in and contribute photos!"],NO_PHOTOS_BY_YOU:["You haven't added any photos yet. What are you waiting for?"],WHO_IS_ME:['Who is this "me" of which you speak?'],INVALID_PERSON:["Never heard of him. her? ...it. Sorry!"],ADD_SOME_PHOTOS:["Add some photos"],NO_PHOTOS:["No photos in this group"],POOL_PREVIEW_HEADER:["Photo pool"],POOL_HEADER:["Group pool"],ADD_PHOTO:["Add photo"],VIEW_X_PHOTOS:[{type:"plural",valueName:"count",options:{one:"View ${#} photos",other:"View ${#} photos"}}],DISCUSSIONS:["Discussions"],ADD_TOPIC:["Add topic"],SEARCH_DISCUSSIONS:["Search discussions"],SEARCH_POOL:["Search pool"],ADD_A_TOPIC:["Add a topic"],TOP_CONTRIBUTORS:["Top Contributors"],CONTRIBUTORS:["Contributors"],CONTRIBUTORS_RANK:["Rank"],CONTRIBUTORS_LATEST_PHOTO:["Latest Photo"],CONTRIBUTORS_PHOTOS:["Photos"],CONTRIBUTORS_DISCUSSIONS:["Discussions"],CONTRIBUTORS_JOINED_GROUP:["Joined Group"],SEE_ALL_MEMBERS:["View all members"],TOTAL_DISCUSSIONS:[{type:"plural",valueName:"count",options:{one:"1 discussion in",other:"${#} discussions in"}}," ","${groupname}"],DISCUSSION_STICKY:["Sticky"],RANKING:["#","${count}"],BLAST_INVITED_MEMBER:["MEMBER"],BLAST_PENDING_MEMBER:["MEMBER"],BLAST_GROUP_MEMBER:["MEMBER"],BLAST_MODERATOR:["MODERATOR"],BLAST_ADMIN:["ADMIN"],SHARE:["Share"],EIGHTTEEN_PLUS_SIGNEDIN:["This group is 18+, do you want to enter?"],EIGHTEEN_PLUS_SIGNEDOUT:["This group is 18+. Sign in to view the group."],NO:["No"],YES:["Yes"],GROUP_POOL_LOADING_ERROR:["Error loading the group's pool photos"],GROUP_DISCUSSION_LOADING_ERROR:["Error loading the group's discussion list"],GROUP_TOP_CONTRIBUTORS_LOADING_ERROR:["Error loading the group's top contributors"],GROUP_DELETION_ERROR:["Something went wrong deleting the photo...please try again."],RETRY:["Retry"],ADDED_NOTIFICATION:['Success! Would you like to <a href="',"${url}",'">add something else</a>?'],NOT_ADDED_NOTIFICATION:['That\u2019s already in the group pool. <a href="',"${url}",'">Try something else?</a>'],PENDING_NOTIFICATION:['Your photo/video has been submitted the group. If approved by the group administrator, it will show up in the group pool. Would you like to <a href="',"${url}",'">add another</a>?'],DONE_PENDING_NOTIFICATION:["All done! There's nothing else to moderate."],GROUP_ADD_PENDING:["Pending approval by administrator"],DELETED_NOTIFICATION:["That item has been removed from the pool."],POOL_MEMBERS_ONLY:["This group pool is for members only."],DISCUSSION_MEMBERS_ONLY:["This group discussion is for members only."],DISCUSSION_MEMBERS_ONLY_INTERSTITIAL:["This group discussion is for members only. Join the conversation with the Join group button above, or click Overview to learn more about the group."],REMOVE_PHOTO:["Remove this photo from the group pool?"],PENDING_COUNT_NOTIFICATION:['You have <a href="',"${url}",'">',{type:"plural",valueName:"pendingCount",options:{zero:"0 photos",one:"${#} photo",other:"${#} photos"}}," pending</a>"],X_GROUPS:[{type:"plural",valueName:"count",options:{one:"${#} Group",other:"${#} Groups"}}],HAS_NONE:["Looks like you don't belong to any group, so there is a list of ones you might like below."],SIGNED_OUT:["Groups are a fabulous way to share content and conversation, either privately or with the world. Believe us when we say there's probably a group for everyone, but if you can't find one you like, feel free to start your own."],LAST_REPLY_TIME_AGO:['<a href="',"${replyurl}",'" data-track="groupDiscussionTopicLastReplyClick">',"${time}"," ago</a>"],MEMBERS_ONLY_POOL_JOIN:["Only members can see this group pool. Click Overview above to learn more about the group, or the Join group button above to, uh...join!"],MEMBERS_ONLY_POOL_SIGN_IN:["Only members can see this group pool. Sign in to join the group."],PRIVATE_GROUP:["You've reached a private group."],RETURN_HOME:["Return home"],DISCUSSIONS_DISABLED:["Discussions are disabled for this group."],GO_TO_GROUP_HOME:["Go to group home"],GROUP_JOIN_RULES_DIALOG_TITLE:["Group Rules"],GROUP_JOIN_RULES_DIALOG_MESSAGE:["If you agree to these rules, you can join the group."],GROUP_JOIN_RULES_DIALOG_ACCEPT:["I agree"],GROUP_JOIN_RULES_DIALOG_DECLINE:["No, thanks"],GROUP_JOIN_ERROR:["Something went wrong with joining the group."],GROUP_LEAVE_ERROR:["Something went wrong with leaving the group."],GROUPS:["Groups"],GROUPS_LIST_LOADING_ERROR:['There was an issue loading the groups.<br>Click <a class="retry">Reload</a> to try again.'],GROUPS_LIST_ERROR_HEADER:["Error loading groups"],CONTRIBUTORS_DISCUSSION_TOPICS:["Topics"],GROUPS_LIST_GROUPS:["Groups"],GROUPS_LIST_MEMBERS
:["Members"],GROUPS_LIST_PHOTOS:["Photos"],GROUPS_LIST_TOPICS:["Topics"],GROUPS_LIST_LATEST:["Latest"],GROUPS_LIST_LATEST_DISCUSSION:["Latest Post"],GROUPS_LIST_LATEST_PHOTO:["Latest Photo"],GROUPS_LEAVE_WARNING_TITLE:["Leave ","${title}","?"],GROUPS_LEAVE_WARNING:['Do you really want to leave the group "',"${title}",'?"'],GROUPS_LEAVE_WARNING_LAST_MEMBER:['Do you really want to leave the group "',"${title}",'"? Because you are the last person in this group, the group will be deleted if you leave.'],GROUPS_LEAVE_WARNING_ADMIN:['Do you really want to leave the group "',"${title}",'"? If you are the last administrator in this group, the longest serving member will be promoted to administrator after you leave.'],GROUPS_LEAVE_WARNING_REMOVE_PHOTOS:["<div class='checkbox-prompt'><label><input type=\"checkbox\">Also remove all the photos & videos you have added to the group pool?</input></label></div>"],GROUPS_LEAVE_WARNING_LEAVE_BUTTON:["Leave this group"],GROUPS_LEAVE_WARNING_CANCEL_BUTTON:["Cancel"],EMPTY_BLAST:["There's no admin blast."],ADD_BLAST:["Why don't you add one?"],REMOVING_BLAST:["Removing Blast..."],CREATE_BLAST:["Add Group Admin Blast"],BACK_TO_OVERVIEW:["Back to group overview"],GROUP_POOL:["Group pool"],NO_VISIBLE_PHOTOS:["${screenname}"," doesn't have any photos visible to you in the ","${groupTitle}"," pool."],UPDATE_BLAST_ERROR:["Could not update the group blast at this time"],DELETE_BLAST_ERROR:["Could not delete the group blast at this time"],LONG_BLAST_ERROR:[{type:"plural",valueName:"count",options:{one:"Group blast is 1 character, it must be less than 496 characters.",other:"Group blast is ${#} characters, it must be less than 496 characters."}}],GROUPS_LIST_BELONG_HEADER:["Groups you are a member of"],GROUPS_LIST_BELONG_MORE:["View all groups you are a member of"],PENDING:[{type:"plural",valueName:"count",options:{one:"1 pending",other:"${#} pending"}}],GROUPS_ADMIN:["Groups you administer"],GROUPS_MODERATED:["Groups you moderate"],GROUPS_BELONG:["Groups you are a member of"],GROUPS_FAVED:["Groups you faved"],VIEW_ALL_GROUPS_ADMIN:["View all groups you administer"],VIEW_ALL_GROUPS_MODERATED:["View all groups you moderate"],GROUP_DESCRIPTION:["Group Description"],GROUP_RULES:["Group Rules"],GROUP_ADDITIONAL_INFO:["Additional Info"],PENDING_MEMBER_COUNT_NOTIFICATION:['You have <a href="',"${url}",'">',{type:"plural",valueName:"pendingCount",options:{zero:"0 pending members",one:"${#} pending member",other:"${#} pending members"}},"</a>"],BLAST_DATE_ADDED:[{type:"date",valueName:"blastDateAdded",format:"long"}],GROUP_DISCUSSION_START:["Start a discussion"],GROUP_DISCUSSION_DELETE_REPLY:["Delete reply"],GROUP_DISCUSSION_CONFIRM_DELETE:["Are you sure you want to delete this reply?"],GROUP_DISCUSSION_DELETE:["Delete"],GROUP_DISCUSSION_DELETE_FAILED:["Failed to delete reply, please try again."],GROUP_DISCUSSION_PUBLISH_FAILED:["Failed to post reply, please try again."],GROUP_DISCUSSION_PUBLISH_REPLY:["Post reply"],GROUP_DISCUSSION_RECENT_DISCUSSIONS:["Discussions"],GROUP_DISCUSSION_POST_REPLY:["Post reply"],GROUP_DISCUSSION_PUBLISH:["Post Reply"],GROUP_DISCUSSION_PREVIEW:["Preview"],GROUP_DISCUSSION_EDIT_FAILED:["Failed to edit reply, please try again."],GROUP_DISCUSSION_EDIT_REPLY:["Edit reply"],GROUP_DISCUSSION_PREVIEW_EDIT_FAILED:["Failed to preview edit, please try again."],GROUP_DISCUSSION_PREVIEW_EDIT:["Preview edit"],GROUP_DISCUSSION_PREVIEW_REPLY_FAILED:["Failed to preview reply, please try again."],GROUP_DISCUSSION_PREVIEW_REPLY:["Preview reply"],GROUP_DISCUSSION_POST_LOCKED_WITH_LINK:["Group discussion in ","${groupname}",' has been locked. (<a href="',"${unlockUrl}",'">unlock?</a>)'],GROUP_DISCUSSION_POST_LOCKED:["This topic has been locked."],GROUP_DISCUSSION_REPLY_EDITED:["Posted ","${createdAgo}",". Edited ","${editedAgo}"],GROUP_DISCUSSION_REPLY_EDITED_WITH_ROLE:["Posted ","${createdAgo}",". Edited by ","${editAuthor}"," (","${editRole}",") ","${editedAgo}"],GROUP_DISCUSSION_REPLY_EDITED_BY_STAFF:["Posted ","${createdAgo}",". Edited by ","${editAuthor}"," (Staff) ","${editedAgo}"],GROUP_DISCUSSION_DELETE_TOPIC:["Delete topic"],GROUP_DISCUSSION_CONFIRM_DELETE_TOPIC:["Are you sure you want to delete this topic?"],GROUP_DISCUSSION_STICKY_FAILED:["Failed to mark/unmark this topic as sticky.  Please try again"],GROUP_DISCUSSION_STICKY:["Sticky"],GROUP_DISCUSSION_LOCK_FAILED:["Failed to lock/unlock this topic.  Please try again"],GROUP_DISCUSSION_LOCK:["Lock Topic"],DISCUSSION_REPLY_REPLY_PROMPT:["Click to reply to the reply"],DISCUSSION_REPLY_PERMALINK_PROMPT:["Permalink"],DISCUSSION_REPLY_DELETE_PROMPT:["Click to delete this reply"],DISCUSSION_REPLY_EDIT_PROMPT:["Click to edit this reply"],GROUP_DISCUSSION_LOCK_CONFIRMATION_TITLE:["Lock topic"],GROUP_DISCUSSION_LOCK_CONFIRMATION:["Are you sure you want to lock this topic?"],GROUP_DISCUSSION_LOCK_BUTTON:["Lock"],GROUP_DISCUSSION_UNLOCK_CONFIRMATION_TITLE:["Unlock topic"],GROUP_DISCUSSION_UNLOCK_CONFIRMATION:["Are you sure you want to unlock this topic?"],GROUP_DISCUSSION_UNLOCK_BUTTON:["Unlock"],DISCUSSION_MORE_LINK:["More..."],DISCUSSION_SEARCH_LINK:["Search this group's discussions"],DISCUSSION_FORMAT_REPLY:["Want to format your reply?"],GROUP_DISCUSSION_FORMATTING_TITLE:["Discussion Formatting"],GROUP_DISCUSSION_FORMATTING_CLOSE:["Close"],SIGN_IN_TO_REPLY:["Sign in to reply"],DISCUSSION_SIGN_IN_TO_REPLY:["Sign in to reply!"],GROUP_DISCUSSION_PUBLISH_FAILED_LOCKED:["Failed to post reply. This topic has now been locked."],GROUP_DISCUSSION_PUBLISH_FAILED_LOCKED_OR_NONMEMBER:["Failed to post reply. This topic is locked or you are not a member of the group."],GROUP_DISCUSSION_PUBLISH_FAILED_DELETED:["Failed to post reply.  This topic has been deleted."],GROUP_DISCUSSION_GROUP_LOCKED:["All discussions are locked for this group"],GROUP_DISCUSSION_GROUP_LOCKED_WITH_LINK:['All discussions are locked for this group (<a title="unlock group discussions?" href="',"${unlockUrl}",'">unlock?</a>)'],CREATED_YEAR:["Since ","${createdYear}"
],UPDATED_TIME_AGO:["Updated ","${updatedAgo}"],GROUP_JOIN:["Join Group"],GROUP_JOIN_SHORT:["Join"],GROUP_JOINED:["Joined"],GROUP_JOIN_REQUESTED:["Join Requested"],GROUP_JOIN_REQUESTED_SHORT:["Pending"],GROUP_LEAVE_GROUP:["Leave Group"],GROUP_LEAVE_GROUP_SHORT:["Leave"],PHOTOS_LINK_LABEL:["Photos"],DISCUSSIONS_LINK_LABEL:["Discussions"],ADMIN_LINK_LABEL:["Administration"],ERROR_LOADING:["There was an error loading this group. Please try again later."],VISIBLE_REPLIES:["(","${from}"," to ","${to}"," of ","${total}"," replies)"],JOIN_GROUP_TO_START_DISCUSSION:["Join the group to start a discussion!"],POOL_PREVIEW:[{type:"plural",valueName:"count",options:{one:"Showing 1 row",other:"Showing ${#} rows"}}],GROUP_BAN_MEMBER:["Ban Member"],GROUP_BAN_MEMBER_FAILED:["Failed to ban the member at this time.  Please try again."],GROUP_BAN_MEMBER_CONFIRM:["Are you sure you want to ban this member from the group?"],GROUPS_BAN_MEMBER_BUTTON:["Ban Member"],GROUPS_BAN_MEMBER_CANCEL_BUTTON:["Cancel"],GROUP_BAN_MEMBER_SUCCESS:["Member successfuly banned from the group"],GROUP_BAN_MEMBER_FAILED_ALREADY:["Failed to ban the member at this time.  They may have already been banned from the group."],GROUP_MEMBERS_SIGNIN:["Sign in to see the group's members."],GROUP_MEMBERS_ERROR_LOADING:["There was an error loading this group's members. Please try again later."],GROUP_MEMBERS_LOADMORE:["Load more members"],GROUP_LANDING_HEADLINE:["Flickr groups are a great way to share photos, post comments, and hold discussions around a common theme."],GROUP_RECOMMENDED_GET_STARTED:["Get started with these Flickr Groups"],GROUP_RECOMMENDED_JOIN_A_GROUP:["Join a group!"]})},"@VERSION@",{requires:["intl"]});
YUI.add("display-collection",function(e){"use strict";var t,n=e.flutil;t=e.Base.create("DisplayCollection",e.FlickrView,[],{initializer:function(t){this.layout=null,this.payload=[],this.displayItemExtras=t.displayItemExtras||{},this.options=n.extend({displayItemCtr:e.Views["display-item-tile"]},t),this._dataEvents=[],t.paft&&(this.paft=t.paft)},initialize:function(){var t=this,n;return n=new e.Promise(function(e,n){t.once("rendered",e),t.render()}),n=n.then(null,function(e){console.error("DisplayCollection.render",e+e.stack)}),n},activate:function(){return this},appendPhotos:function(e,t){t||(t=this.options.displayItemCtr),Array.isArray(e)||(e=[e]),this.payload=this.payload.concat(e.map(function(e){return{displayItem:null,displayItemCtr:t,type:"PhotoModel",service:null,renderBatch:null,params:{photo:e}}}))},appendDisplayItems:function(e){Array.isArray(e)||(e=[e]),this.payload=this.payload.concat(e.map(function(e){return{displayItem:e,displayItemCtr:e.constructor,type:"DisplayItem",service:null,renderBatch:null,params:null}}))},appendCollection:function(e,t){var n=this,r,i,s;t||(t=this.options.displayItemCtr),r=function(e,t){t?n.payload=i(e).concat(n.payload):n.payload=n.payload.concat(i(e))},i=function(n){return n.map(function(n){return{displayItem:null,displayItemCtr:t,type:"CollectionPaginator",service:e,renderBatch:null,params:{photo:n}}})},this.detachDataEvents(),s=e.on("listValueChanged",function(e){e.prepended?r(e.prepended,!0):r(e.added||[]),n.render()}),n._dataEvents.push(s),r(e.getCurrentPageAsList())},removePhotos:function(e){var t=this,n;n=e.map(function(e){var n;return t.payload.some(function(t){return t.params&&t.params.photo===e?(n=t,!0):!1}),n}).filter(function(e){return!!e}),n.length&&n.forEach(function(e){e.displayItem.remove()})},clear:function(){if(!this.payload||!this.payload.length)return;this.payload.forEach(function(e){e.displayItem&&e.displayItem.destroy(),e.layout=e.params=null}),this.layout&&this.layout.destroy(),this.initializer(e.merge({},this.options))},createDisplayItem:function(e){var t,r,i=this;return e.displayItem?e.displayItem:(t=n.extend(this.displayItemExtras,e.params,{appContext:this.appContext}),r=e.displayItem=new e.displayItemCtr(t),this.displayItemExtras.photoDeleteRights&&this._dataEvents.push(r.on("deletePhoto",function(e){i.fire("deletePhoto",e)})),r)},render:function(){var e=this,t;this._batch||(this._batch=0),this._batch++,t=this.payload.reduce(function(t,n){if(n.renderBatch)return t;n.renderBatch=e._batch;var r=e.createDisplayItem(n);return t.push(r),t},[]),this.layout.append(t)},positionFromHistory:function(){console.warn("display-collection::positionFromHistory() is a no-op. Implement on a subclass if needed.")},next:function(){var e=this.payload.slice(-1)[0];if(!e||!e.service||!e.service.next)return;return e.service.next()},getId:function(){return"DC-"+this.name.toUpperCase()},detachDataEvents:function(){this._dataEvents.forEach(function(e){e.detach()}),this._dataEvents=[]},destructor:function(){this.detachDataEvents(),this._dataEvents=null,this.layout&&this.layout.destroy(),this.layout=null,this.payload.forEach(function(e){e.displayItem&&e.displayItem.destroy(),e.layout=e.params=null}),this.options=null}},{ATTRS:{container:{value:"",setter:function(e){var t=e||this.getContainer({viewName:n.unCamelCaseify(this.name)});return t}}}}),e.DisplayCollection=t},"@VERSION@",{requires:["flickr-view","flutil","display-item-tile"]});
YUI.add("layout-engine",function(e){"use strict";var t,n,r,i,s=e.flutil,o,u,a;u={debug:!1,displayCollectionListSelector:'[data-layout-element="displayCollection"]'},a={},o=s.getLogger(u.debug),t=function(){e.SimpleEventEmitter.apply(this),this.payload=[],this._style={},this._el={},this.options={}},t.prototype=s.objectCreate(e.SimpleEventEmitter.prototype,{init:function(e){e||(e=this.options),this.container=e.container,this.template=e.template,this.templatePartial=e.templatePartial},renderFragment:function(e){if(!e||!e.length)return this.renderFragmentWrappers([]);var t=this,n,r,i=e.length;n=function(n){if(--i)return;t.renderFragmentWrappers(e)},r=function(e){var t=e.view||e;YUI.Env.isServer||(t.updateDom(),t.activate()),n()},e.forEach(function(e){var t=e.displayItem;if(t.is("rendered"))return r(t);t.once("rendered",r),t.initialize()})},renderFragmentWrappers:function(e){var t=this,i,s,o,a,f,l;this.container.hasChildNodes()||(f=(YUI.Env.isServer?e:e.slice(0,1)).map(function(e){return e.toTemplateJSON()}),o={displayWrappers:f,layout:{styles:this.stylesToJSON()}},this.resetStyles(),i=this.template(o),this.container.setHTML(i),YUI.Env.isServer||(a=this.container.one(u.displayCollectionListSelector),a&&a.setHTML(""))),YUI.Env.isServer||(s=new n,e.forEach(function(e){var n;e.isRendered?e.updateDom():(n=new r,n.render(t.templatePartial,e.toTemplateJSON()),e.setContainer(n.get("firstChild")),s.appendChild(e.container))}),this.updateDom(),s.numNodes()&&(l=this.container.one(u.displayCollectionListSelector),l.appendChild(s.getNode()))),this.fire("rendered")},setStyles:function(e,t){this._style[e]||(this._style[e]={}),s.extend(this._style[e],t)},stylesToJSON:function(){var e=this;return Object.keys(this._style).reduce(function(t,n){var r=e._style[n];return t[n]=Object.keys(r).reduce(function(e,t){return e+t+":"+r[t]+";"},""),t},{})},updateDom:function(){if(YUI.Env.isServer)return;var e=this,t=this.container||this.get("container");Object.keys(this._style).forEach(function(n){var r=e._el[n];r||(e._el[n]=r=t.getDOMNode().getAttribute("data-layout-element")===n?t:t.one('[data-layout-element="'+n+'"]'));if(!r)return;r.setStyles(e._style[n])}),this.resetStyles()},resetStyles:function(){this._style={}},render:function(){console.warn("layout-engine::render() is a no-op. Implement on a subclass if needed.")},append:function(){console.warn("layout-engine::append() is a no-op. Implement on a subclass if needed.")},remove:function(){console.warn("layout-engine::remove() is a no-op. Implement on a subclass if needed.")},scrollTo:function(){console.warn("layout-engine::scrollTo() is a no-op. Implement on a subclass if needed.")},destroy:function(){var t=this.container.one(u.displayCollectionListSelector);t&&t.remove(),this.options=null,this.container.detach(),this.container=null,this._el=null,this._style=null,e.SimpleEventEmitter.prototype.destroy.apply(this)}}),i=t.DisplayWrapper=function(e){this.layout=null,this.container=null,this.displayItem=e,this._style={},this._el={},this.isRendered=!1},i.prototype={setContainer:function(e){this.container=e;var t=this.container.one(".view");t&&this.displayItem.acquireContainer(t),this.isRendered=!0},bindLayout:function(e){this.layout=e},hasLayout:function(){return!!this.layout},setStyles:function(e,t){this._style[e]||(this._style[e]={}),s.extend(this._style[e],t)},position:function(e,t){this.setStyles("displayWrapper",{top:e+"px",left:t+"px"}),this.displayItem.fire("position",{top:e||null,left:t||null})},resetStyles:function(){this._style={}},updateDom:function(){if(YUI.Env.isServer)return;var e=this,t=this.container;Object.keys(this._style).forEach(function(n){var r=e._el[n];r||(e._el[n]=r=t.getDOMNode().getAttribute("data-layout-element")===n?t:t.one('[data-layout-element="'+n+'"]'));if(!r)return;r.setStyles(e._style[n])}),this.resetStyles()},getId:function(){return"DW"+this.displayItem.photo.id},toStylesJSON:function(){var e=this;return Object.keys(this._style).reduce(function(t,n){var r=e._style[n];return t[n]=Object.keys(r).reduce(function(e,t){return e+t+":"+r[t]+";"},""),t},{})},toTemplateJSON:function(){return{layout:{styles:this.toStylesJSON()},displayItem:this.displayItem,id:this.getId()}},destroy:function(){}},n=t.DocumentFragment=function(){this.init()},n.prototype=YUI.Env.isServer?{init:function(){this.html=""},appendChild:function(e){this.html+=e.html},getNode:function(){return this}}:{init:function(e){this._nodes=0,this._fragment=document.createDocumentFragment()},appendChild:function(e){this._nodes++,this._fragment.appendChild(e.getDOMNode())},getNode:function(){return this._fragment},numNodes:function(){return this._nodes}},r=t.DocumentElement=function(){this.init()},r.prototype=YUI.Env.isServer?{init:function(){this.html=""},render:function(e,t){this.setHTML(e(t))},setHTML:function(e){this.html=e},get:function(e){if(e==="firstChild")return this},getDOMNode:function(){return null}}:{init:function(){this.el=document.createElement("div")},setHTML:function(e){this.el.innerHTML=e},render:function(e,t){this.setHTML(e(t));var n=Object.keys(t).reduce(function(e,n){return t[n].render&&(e[t[n].getId()]=t[n].get("container").getDOMNode()),e},{});Array.prototype.slice.call(this.el.getElementsByClassName("hb-placeholder")).forEach(function(e){e.parentNode.replaceChild(n[e.id],e)})},get:function(t){if(t==="firstChild")return e.one(this.el.firstChild)},getDOMNode:function(){return this.el}},e.LayoutEngine=t},"@VERSION@",{requires:["flutil","flickr-promise","simple-event-emitter"]});
YUI.add("layout-engine-justified-row",function(e){"use strict";var t,n=e.flutil,r,i;i={debug:!1,sizeBreakPoint:1500,sizeBump:1.3},r=n.getLogger(i.debug),t=function(t){e.SimpleEventEmitter.apply(this),this.payload=[],this.layoutEngine=null,this.rowIndex=null,this.options=n.extend({vertPadding:5,horizPadding:5,targetHeight:299,targetHeightTolerance:.29,width:"auto",layoutEngine:{}},t),this._targetRange={},this.init()},t.prototype=n.objectCreate(e.SimpleEventEmitter.prototype,{init:function(e){e||(e=this.options),this.height=0,this.displayWidth=this.availableWidth=typeof e.width=="number"?e.width:800,this.width=0,this.overflow=0,this.offsetTop=0},bindLayout:function(e){this.layoutEngine=e.layoutEngine,this.rowIndex=e.rowIndex},addItem:function(e){var t,n=this.getTargetAreaSize();this.payload.push(e);if(this.getScaledWidth()>this.displayWidth&&this.payload.length>1){t=this.getScaledHeight();if(t<n.minHeight||t>n.maxHeight){this.payload.pop(),e.bindLayout(null);return}}e.bindLayout({row:this})},end:function(){var e;e=this.getScaledWidth(this.targetHeight),this.displayWidth=Math.min(e,this.availableWidth)},clear:function(){this.displayWidth=this.availableWidth,this.payload.forEach(function(e){e.bindLayout(null)});var e=this.payload;return this.payload=[],e},getTargetAreaSize:function(){if(this._targetRange._displayWidth===this.displayWidth)return this._targetRange;var e=this.displayWidth>i.sizeBreakPoint?this.options.targetHeight*i.sizeBump:this.options.targetHeight,t=Math.floor(e*(1-this.options.targetHeightTolerance)),n=Math.ceil(e*(1+this.options.targetHeightTolerance));return this._targetRange={_displayWidth:this.displayWidth,targetHeight:e,minHeight:t,maxHeight:n}},computeLayout:function(){var e=this.getTargetAreaSize();return this.height=this.getScaledHeight(),this.height<e.minHeight?this.height=e.minHeight:this.height>e.maxHeight&&(this.height=e.maxHeight),this.width=this.getScaledWidth(this.height),this.overflow=this.width-this.displayWidth,this.offsetTop=this.layoutEngine.getRowStackHeight(this.rowIndex-1)+this.rowIndex*this.options.vertPadding,!0},getAspectRatio:function(){return this.payload.reduce(function(e,t){return e+t.displayItem.assetManager.getAspectRatio()},0)},getScaledWidth:function(e,t){var n;return e||(e=this.getTargetAreaSize().targetHeight),t=t===undefined?this.options.horizPadding:t|0,n=this.getAspectRatio()*e+t*(this.payload.length-1),Math.ceil(n)},getScaledHeight:function(){var e,t;return t=this.getAspectRatio(),e=this.displayWidth-(this.payload.length-1)*this.options.horizPadding,Math.ceil(1/t*e)},render:function(){var e=this,t,n,i;t=this.computeLayout();if(!t){r.log("JustifiedRow.computeLayout found no solution");return}n=this.overflow/this.payload.length|0,i=0,this.payload.forEach(function(t){var r=t.displayItem,s,o;t.position(e.offsetTop,i),o=i===0?e.overflow-n*(e.payload.length-1):n,s=r.assetManager.getScaledWidth(e.height)-o,r.resize(s,e.height),i+=r.frameWidth+e.options.horizPadding})},getWrappers:function(){return this.payload||[]},destroy:function(){this.payload.forEach(function(e){e.bindLayout(null)}),this.payload=null,this.options=null,this.layoutEngine=null,e.SimpleEventEmitter.prototype.destroy.apply(this)}}),e.LayoutEngineJustifiedRow=t},"@VERSION@",{requires:["flutil","flickr-promise","simple-event-emitter"]});
YUI.add("hermes-template-display-collection-justified-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="ui-display-wrapper ui-display-wrapper-justified" id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-layout-element="displayWrapper" style="'+f((o=(o=(o=t.layout,o==null||o===!1?o:o.styles),o==null||o===!1?o:o.displayWrapper),typeof o===a?o.apply(t):o))+'">\n	',u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t.displayItem,u):l.call(t,"outlet",t.displayItem,u)))+"\n</div>\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/display-collection-justified-item",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-display-collection-justified",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;r+="\n		",i=n.each.call(e,e.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(2,h,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function h(e,t){var i="",s;i+="\n			",s=a.invokePartial(r["display-collection-justified-item"],"display-collection-justified-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a=this,f="function",l=this.escapeExpression;s+='<section data-layout-element="displayCollection" style="'+l((o=(o=(o=t.layout,o==null||o===!1?o:o.styles),o==null||o===!1?o:o.displayCollection),typeof o===f?o.apply(t):o))+"\">\n	<script>\n		//getting the cookie with no library\n		var liqpw = (document.cookie.match(/liqpw\\s*=\\s*(\\d+)/) || [])[1] || 0;\n\n		//if cookie width is incorrect!\n		if (window.innerWidth != liqpw) {\n			document.body && document.body.classList.add('ui-state-wrong-cookie-width');\n		}\n	</script>\n	",u=n["if"].call(t,t.displayWrappers,{hash:{},inverse:a.noop,fn:a.program(1,c,i),data:i});if(u||u===0)s+=u;return s+="\n</section>\n",s}),r={};e.Array.each(["display-collection-justified-item"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/display-collection-justified",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-display-collection-justified-item"]});
YUI.add("layout-engine-justified",function(e){"use strict";var t,n=e.LayoutEngine.DisplayWrapper,r,i,s;i={debug:!1,vertPadding:8,horizPadding:8,bottomPadding:8,targetHeight:320,targetHeightTolerance:.25,maxHorizOverflow:5,gutterWidth:0,autoGutterToContentWidth:!1,bufferTop:3,bufferBottom:3},s={unWrapDisplayItem:function(e){return e.displayItem}},r=e.flutil.getLogger(i.debug),t=function(t){this.rows=[],this.currentRow=null,e.LayoutEngine.apply(this),this.options=e.flutil.extend({vertPadding:i.vertPadding,horizPadding:i.horizPadding,leftRightPadding:t.canvas==="fluidContainer"?0:i.horizPadding,bottomPadding:i.bottomPadding,targetHeight:i.targetHeight,gutterWidth:i.gutterWidth,autoGutterToContentWidth:i.autoGutterToContentWidth,targetHeightTolerance:i.targetHeightTolerance,viewport:null,container:null,monitorViewport:!0,scrolling:!0,template:e.flutil.getTemplate("display-collection-justified"),templatePartial:e.flutil.getTemplate("display-collection-justified-item")},t),this.init()},t.prototype=e.flutil.objectCreate(e.LayoutEngine.prototype,{init:function(t){t||(t=this.options),this.container=t.container,this.template=t.template,this.templatePartial=t.templatePartial,this.viewport=e.flutil.extend({width:800,height:600,scrollbarWidth:16},t.viewport),this.assignEventHandlers()},assignEventHandlers:function(){var t=this;!YUI.Env.isServer&&this.options.monitorViewport&&(this.options.singleRow||this.setViewportCookies(),this.options.scrolling&&this.scrollPolling(),e.use("global-events",function(e){t._resizeEventHandle=e.globalEvents.subscribe("window:resize",t.onResize.bind(t))}))},setViewportCookies:function(){e.flutil.setCookie({remove:!0,cookieName:"liqpw",path:"/",cookieValue:this.viewport.width+this.options.gutterWidth*2}),e.flutil.setCookie({remove:!0,cookieName:"liqph",path:"/",cookieValue:this.viewport.height})},scrollPolling:function(){var t,n=100,r=Math.floor(this.options.targetHeight/2),i=this;this._scroll=t={timer:null,offsetY:0,offsetVisibilityY:0,offsetTop:this.container.getY(),state:"still",shield:document.createElement("div"),shieldState:!1},t.shield.classList.add("ui-display-scrollshield"),document.body.appendChild(t.shield),t.timer=setInterval(function(){var s=e.config.win.pageYOffset;s===t.offsetY?(t.state!=="still"&&i.fire("scrollStop"),t.state="still",t.shieldState&&(t.shield.style.display="none"),t.shieldState=!1):(e.config.win.paftTiming&&(e.config.win.paftTiming=null),t.state="scroll",Math.abs(s-t.offsetY)<n?(t.shieldState&&(t.shield.style.display="none"),t.shieldState=!1):(t.shieldState||(t.shield.style.display="block"),t.shieldState=!0)),t.offsetY=s,Math.abs(s-t.offsetVisibilityY)>r&&(t.offsetVisibilityY=s,i.computeVisible())},250)},onResize:function(t){var n,r=this;switch(this.options.canvas){case"screen":case"container":n=e.config.win.innerWidth;break;case"fluidContainer":default:n=this.container.get("clientWidth")}return n?(this.options.singleRow?this.fire("resize",function(e,t){r.viewport.width=e,r.viewport.height=t,r.reflow()}):(this.options.autoGutterToContentWidth&&(this.options.gutterWidth=(n-this.options.autoGutterToContentWidth)/2),this.viewport.width=n-this.options.gutterWidth*2,this.viewport.height=e.config.win.innerHeight,this.setViewportCookies(),this.reflow()),!0):!1},computeVisible:function(){var t,n=[],r=[],o=[],u,a,f,l,c,h,p=this.rows.length,d,v,m,g;t=this._scroll?this._scroll.offsetY:e.config.win.pageYOffset,f=this.viewport.height*i.bufferTop,l=this.viewport.height*i.bufferBottom,c=t-f-this.options.targetHeight,h=t+this.viewport.height+l,u=t-this.options.targetHeight/2|0,a=t+this.viewport.height,d=this._scroll?this._scroll.offsetTop:this.container.getY(),this._bottom||(this._bottom=1);for(g=0;g<p;g++)v=this.rows[g],m=v.offsetTop+d,m>u&&m<a&&(o=o.concat(v.payload)),this.options.singleRow&&g>0?r=r.concat(v.payload):m<c?r=r.concat(v.payload):m>c&&m<h?(n=n.concat(v.payload),g===p-1&&g>this._bottom&&(this._bottom=g,this.fire("bottom",{row:this.rows[g]}))):m>h&&(r=r.concat(v.payload));this.fire("visibilitychanged",{viewsVisible:o.map(s.unWrapDisplayItem),viewsIn:n.map(s.unWrapDisplayItem),viewsOut:r.map(s.unWrapDisplayItem)})},scrollTo:function(t,n){var r,s,o;n=(n||0)-i.vertPadding;if(typeof t=="string"){for(r=0,s=this.payload.length;r<s;r++)if(this.payload[r].displayItem.photo.id===t){t=this.payload[r];break}}else if(!t.layout)for(r=0,s=this.payload.length;r<s;r++)if(this.payload[r].displayItem===t){t=this.payload[r];break}if(!t)return;o=function(){if(!o.ttl)return;if(o.view.container){var t=o.view.container.getDOMNode();t.scrollIntoView&&t.scrollIntoView(),n&&e.config.win.scrollBy(0,n);return}o.ttl--,setTimeout(o,10)},o.ttl=300,o.view=t,o()},addRow:function(){var t,n,r;t=this.rows.length,r=this.viewport.width-2*this.options.leftRightPadding-this.viewport.scrollbarWidth,n={vertPadding:this.options.vertPadding,horizPadding:this.options.horizPadding,targetHeight:this.options.targetHeight,targetHeightTolerance:this.options.targetHeightTolerance,width:this.options.infiniteRow?Number.MAX_VALUE:r},this.currentRow=new e.LayoutEngineJustifiedRow(n),this.currentRow.bindLayout({layoutEngine:this,rowIndex:t}),this.rows.push(this.currentRow)},getRowStackHeight:function(e){var t=e===undefined?this.rows.length:e+1,n=0,r;for(r=0;r<t;r++)n+=this.rows[r].height||this.rows[r].options.targetHeight;return n},append:function(e){if(!Array.isArray(e))return;var t,r={};this.container.all(".ui-display-wrapper").each(function(e){r[e.get("id")]=e}),t=e.map(function(e){var t=new n(e),i=r[t.getId()];return i&&t.setContainer(i),t}),this.payload=this.payload.concat(t),this.render(this.currentRow)},remove:function(e){e.forEach(function(e){e.remove()})},render:function(e){var t=this,n,r,i,s,o,u,a=[];if(!this.payload.length){this.fire("rendered");return}n=this.payload,e&&(this.currentRow=e,r=e.clear().shift(),n=this.payload.slice(this.payload.indexOf(r))),this.currentRow||this.addRow();for(o in n)i=n[o],t.currentRow.addItem(i),i.hasLayout()||(t.currentRow.render(),!s&&t.options.singleRow&&(
s=t.currentRow.height),t.addRow(),t.currentRow.addItem(i)),a.push(i);this.currentRow.end(),this.currentRow.render(),this.setStyles("displayCollection",{height:this.currentRow.offsetTop+this.currentRow.height+"px",position:"relative",margin:this.options.vertPadding+"px "+this.options.leftRightPadding+"px "+this.options.bottomPadding+"px "+(this.options.leftRightPadding+this.options.gutterWidth)+"px"}),s&&this.options.singleRow?u=s:u=this.currentRow.height,this.fire("adjustContainer",u),this.renderFragment(a),!this._cookieChecked&&!YUI.Env.isServer&&(this._cookieChecked=!0,setTimeout(function(){document.body.classList.remove("ui-state-wrong-cookie-width")},500))},reflow:function(){this.rows.forEach(function(e){e.destroy()}),this.rows=[],this.currentRow=null,this._bottom=null,this.render(),this.computeVisible(),this.fire("reflowed")},destroy:function(){this._scroll&&(this._scroll.shield.parentNode.removeChild(this._scroll.shield),this._scroll.shield=null,clearInterval(this._scroll.timer)),this._resizeEventHandle.detach(),this.rows.forEach(function(e){e.destroy()}),this.rows=null,this.currentRow=null,e.LayoutEngine.prototype.destroy.apply(this)}}),e.LayoutEngineJustified=t},"@VERSION@",{requires:["flutil","flickr-promise","layout-engine","layout-engine-justified-row","hermes-template-display-collection-justified","display-collection-justified-css"]});
YUI.add("display-collection-justified",function(e){"use strict";var t;t=e.Base.create("DisplayCollectionJustified",e.DisplayCollection,[],{initializer:function(t){var n,r={},i=t.gutterWidth||0,s=t.autoGutterToContentWidth||!1,o=this.get("container"),u,a;YUI.Env.isServer?(r.width=parseInt(this.appContext.getCookie("liqpw"),10),r.height=parseInt(this.appContext.getCookie("liqph"),10),r.scrollbarWidth=this.appContext.getCookie("liqsb")?parseInt(this.appContext.getCookie("liqsb"),10):16):(a={width:e.config.win.innerWidth,height:e.config.win.innerHeight},this.options.canvas==="fluidContainer"?(u=e.one("."+o.getDOMNode().className.replace(" ",".")),u?r.width=u.get("clientWidth"):this._resizeQueued=!0,r.width||(r.width=parseInt(this.appContext.getCookie("liqpw"),10)),r.width||(r.width=e.config.win.innerWidth),r.scrollbarWidth=0):r.scrollbarWidth=function(){var t,n;return t=document.createElement("div"),t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),n=100-t.clientWidth,t.parentNode.removeChild(t),e.flutil.setCookie({remove:!0,cookieName:"liqsb",path:"/",cookieValue:n}),n}()),this.options=e.flutil.extend(this.options,{canvas:"container",hibernate:!0},t);switch(this.options.canvas){case"screen":this.options.viewport=e.flutil.extend({width:r.width||a&&a.width||800,height:r.height||a&&a.height||600,scrollbarWidth:r.scrollbarWidth},this.options.viewport),s&&(i=(this.options.viewport.width-s)/2),this.options.viewport.width-=i*2;break;case"fluidContainer":this.options.viewport=e.flutil.extend({width:r.width||800,height:r.height||a&&a.height||600,scrollbarWidth:r.scrollbarWidth},this.options.viewport),s&&(i=(this.options.viewport.width-s)/2),this.options.viewport.width-=i*2;break;case"container":default:console.warn("This doesn't appear to be fully implemented yet. See note above about using canvas: 'container'."),this.options.viewport=e.flutil.extend({width:o.get("offsetWidth"),height:o.get("offsetHeight")||a&&a.height,scrollbarWidth:r.scrollbarWidth},this.options.viewport)}return n=e.flutil.extend({},this.options,{container:o,gutterWidth:i,autoGutterToContentWidth:s}),this.setupLayoutEngine(n),this},setupLayoutEngine:function(t){var n=this,r=!0,i,s,o;i=this.options.beaconViews?function(e){var t=n.options.beaconViews,r=document.URL;e.forEach(function(e){t.queue(e.photo&&e.photo.id,r,"true")})}:function(){},s=this.options.hibernate?this._queueForHibernation.bind(this):function(){},YUI.Env.isServer||(o=e.config.win.scrollY),this.layout=new e.LayoutEngineJustified(t),this.layout.on("rendered",function(t){r&&!YUI.Env.isServer&&(r=!1,e.config.win.setTimeout(function(){n._resizeQueued&&n.layout.onResize?(n._resizeQueued=!1,n.layout.onResize(null)||n._resizePoll()):n.layout.computeVisible()},0)),n.fire("rendered",t)}),this.layout.on("resize",function(e){n.fire("resize",e)}),this.layout.on("adjustContainer",function(e){n.fire("adjustContainer",e)}),this.layout.on("reflowed",function(t){e.Views.dialog.close()}),this.layout.on("bottom",function(e){e.loading=n.next(),n.fire("bottom",e)}),this.layout.on("visibilitychanged",function(t){var r=t.viewsVisible,u,a=0;s("wake",t.viewsIn,function(){s("hibernate",t.viewsOut),YUI.Env.isServer||o!==e.config.win.scrollY&&n._updateScrollHistory(t.viewsVisible[0])}),e.config.win.paftTiming&&!e.config.win.paftTiming.final&&n.appContext.flipper.isFlipped("paft")&&(r.forEach(function(t){a<e.config.win.paftTiming[t.photo.id]&&(a=e.config.win.paftTiming[t.photo.id])}),n.appContext.clientMetrics&&e.config.win.paftTiming&&(e.config.win.performance&&e.config.win.performance.timing&&(u=e.config.win.performance.timing),u&&(e.config.win.paftTiming.final=a,n.appContext.clientMetrics.record("AFT",a-u.navigationStart),n.appContext.clientMetrics.record("AFT_SV",a-u.navigationStart),n.appContext.clientMetrics.beaconLater()),e.config.win.paftTiming=null)),i(t.viewsVisible)}),this.layout.on("scrollStop",function(){n.options.beaconViews&&n.options.beaconViews.flushQueue()})},positionFromHistory:function(){var t;if(YUI.Env.isServer)return;t=e.StorageHelper.getItem(this._generateLocationHash(),!0),t&&this.scrollToPhotoId(t,0)},scrollToPhotoId:function(e,t){this.layout.scrollTo(e,t)},_queueForHibernation:function(t,n,r){var i=25,s=n.length,o,u;if(!s)return r&&r();o=0,u=function(){var a,f=Math.min(s,o+i);for(a=o;a<f;a++)n[a][t]();if(f>=s-1)return r&&r();o=f-1,e.config.win.requestAnimationFrame(u)},e.config.win.requestAnimationFrame(u)},_updateScrollHistory:function(t){if(YUI.Env.isServer)return;t&&t.photo&&e.StorageHelper.setItem(this._generateLocationHash(),t.photo.id,!0)},_generateLocationHash:function(){var e="dc_scrollToPhotoId_"+document.location.pathname+document.location.search;return e.replace(/[^\w\d]/gi,"")},_resizePoll:function(e){function i(){setTimeout(function(){r.layout.onResize(null)||++n<t&&(e*=2,i())},e)}var t=5,n=0,r=this;e||(e=100),i()}}),e.DisplayCollectionJustified=t},"@VERSION@",{requires:["flutil","storage-helper","display-collection","layout-engine-justified","display-item-tile"]});
