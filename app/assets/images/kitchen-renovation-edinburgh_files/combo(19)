YUI.add("contact-search-box",function(e){var t,n=function(n){this.options=n,this.options.elValue=this.options.elValue||"value",this.options.hideInitially||[],this._contacts=null,this.queryEl=this.options.el,this.queryElEvent,this.listEl=null,t=this.options.DOMContainer||e.config.win,this.init()};n.prototype={langBundles:["common","photo-page-scrappy"],init:function(){var t=this;this.options.showFollowingState!==!1&&(this.options.showFollowingState=!0),this.queryEl.on("keydown",this.keynav.bind(this)),this.queryElEvent=this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=e.Node.create("<div/>"),this.wrapperEl.addClass("c-contact-search-autocomplete"),this.listEl=e.Node.create("<ul/>"),this.listEl.addClass("contact-list"),this.wrapperEl.appendChild(this.listEl),this.listEl.on("mouseover",function(e){var n=e.target.ancestor("li",!0);if(!n||n===t.highlighted)return;t._highlight(n)}),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.options.clickContact=this.options.clickContact||function(e){var n=e.target.ancestor("[data-nsid]",!0).getData("nsid");t.select(n)},this.listEl.delegate("click",this.options.clickContact,"li"),this.selectedIndex=0},keynav:function(e){e.keyCode===38?(e.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.numShowing+this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===40?(e.preventDefault(),this.selectedIndex++,this.selectedIndex>this.numShowing-1&&(this.selectedIndex=this.numShowing-this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===9?this._visible&&this.highlighted&&(e.preventDefault(),this.select(this.highlighted.getData("nsid"))):e.keyCode===13&&this._visible&&this.highlighted&&(e.preventDefault(),e.target.ancestor(".share-view",!0)?this.select(this.highlighted.getData("nsid")):this.options.clickContact(e,this.highlighted))},_highlight:function(t){var n=this.listEl.all("li"),r=t instanceof e.Node,i=r?t:n.item(t),s=r?n.indexOf(t):t;i&&!i.hasClass("loading")&&!i.hasClass("no-members")&&(n.removeClass("highlight"),i.addClass("highlight"),this.selectedIndex=s,this.highlighted=i)},_scrollToNode:function(e){var t=this.listEl.get("scrollTop"),n=t+this.listEl.get("clientHeight"),r=e.get("offsetTop"),i=r+e.get("clientHeight"),s=5;t>r?this.listEl.set("scrollTop",r-s):n<i&&this.listEl.set("scrollTop",i-this.listEl.get("clientHeight")+s)},getContact:function(e){var t=0,n=this._contacts,r=n.length;for(;t<r;t++)if(n[t].nsid===e&&!n[t].hide)return n[t]},hideFromSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!0,!0})},showInSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!1,!0})},load:function(e){var t={},n=this,r,i;if(this._busy)return;return this._end=!1,this._busy=!0,t.can_tag=this.options.canTag||0,i=this.options.appContext.getViewer().nsid,r=this.options.appContext.getModel("contacts-models",i),r.then(function(r){return t.page=1,t.perPage=3e3,t.per_page=3e3,n._loadMoreContacts(r,t,e)},function(){n._busy=!1,n.options.onError()})},_loadMoreContacts:function(e,t,n){var r=this;return this._busy=!0,r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),e.getValue("contacts").getPage(t).then(function(i){r.options.appContext.flipper.isFlipped("search-outside-contacts")||(r._busy=!1),r._contacts=(r.processContactModels(i,!0,!0)||[]).concat(r._contacts||[]),n(),t.page<e.getValue("pages")&&(t.page++,r._loadMoreContacts(e,t,n))},function(){r._busy=!1,r.options.onError()})},processContactModels:function(t,n,r){var i=this,s,o,u;try{u=t.map(function(e){return e.toJSON()})||[]}catch(a){u=[]}if(!i.contactIds){i.contactIds={};if(i._contacts)for(o in i._contacts)i.contactIds[o.id]=!0}return u=u.filter(function(e){return!i.contactIds[e.id]}),u.forEach(function(t,n){i.contactIds[t.id]=!0,t.realname=t.realname||t.username,t.isContact=r,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver)}),n&&i.options.me&&(s=i.options.me.toJSON(),e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.buddyicon),s.buddyicon=s.buddyicon["default"],i.contactIds[s.id]=!0,s.me=!0,u.push(s)),i.options.hideInitially&&u.forEach(function(e){i.options.hideInitially.indexOf(e.nsid)>-1&&(e.hide=!0)}),u},destructor:function(){this.queryElEvent&&this.queryElEvent.detach&&this.queryElEvent.detach()},hide:function(e){e&&e.halt();if(!this._visible)return;this._visible=!1,this.highlighted=null,this.selectedIndex=0,this.selected=null,this.options.noShim||this._shimUp(!1),this.listEl.setStyle("display","none"),this.options.onHide&&this.options.onHide()},show:function(){if(this._visible)return;this._visible=!0,this.options.noShim||this._shimUp(),this.listEl.setStyle("display","block"),this._reposition(),this.options.onShow()},_reposition:function(){var n={width:t.innerWidth||t.clientWidth,height:t.innerHeight||t.clientHeight},r=this.options.el,i=r.getDOMNode(),s=i.getBoundingClientRect(),o=this.listEl.getDOMNode().getBoundingClientRect(),u=!this._contacts,a=u&&this.options.upInitially,f=t===e.config.win?s.top:i.clientTop,l;this.options.dialogOffset&&(l=this.options.dialogOffset()),a||f>0&&f+o.height+25>n.height&&!this.options.alwaysDownward?(this.listEl.setStyle("top","auto"),this.listEl.setStyle("bottom","25px"),this.options.onOrientationChange&&this.options.onOrientationChange(!0)):(this.listEl.setStyle("top",l||null),this.listEl.setStyle("bottom",null),this.options.onOrientationChange&&this.options.onOrientationChange(!1),r.ancestor(".modal",!0)&&this.listEl.setStyle("maxHeight",n.height-o.height-f-25))},_shimUp:function(t){if(t===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div/>"),this._shim.addClass(this.options.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild
(this._shim)},select:function(e){typeof e=="string"&&(e=this.getContact(e),this.queryEl.set("value",e.realname)),this.selected=e,this.options.onSelect(e),this.hide()},search:function(e){var t=this.queryEl.get(this.options.elValue),n=this,r,i,s,o=this.options.appContext.getViewer().nsid;if(e&&e.keyCode===27){e.preventDefault(),this.queryEl.blur();return}if(e&&[38,40,9].indexOf(e.keyCode)!==-1){e.preventDefault();return}this._nameTest(t),this.selected=null,this.selectedIndex=0,this.abort=!1;if(t.trim()==="")return this.abort=!0,this.hide();this.options.searchNonContacts||(this._end=!0,this._busy=!1);if(this._contacts&&this.options.me&&t==="me")return this.showResults(this._contacts.filter(function(e){return!e.hide&&e.me}).concat(this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})));if(this._isEmail(t))return this.select({email:t,nsid:null});if(/,/.test(t))return this.select(null);if(!this._contacts)return this.showResults(),this.options.signedOut?null:this.load(this.search.bind(this));r=this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)}),this.showResults(r),i=n.listEl.getDOMNode(),this.options.searchNonContacts&&(this.options.loadMoreOnScroll&&n.options.appContext.flipper.isFlipped("search-outside-contacts")&&t.length>0?(s=1,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){n._searchPeople(t,o,s,n.searchInstanceId,function(){n._busy=!1,n.showResults(n._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),n.listElScrollEvent=n.listEl.on("scroll",function(){n.listEl._node.clientHeight+n.listEl._node.scrollTop===n.listEl._node.scrollHeight&&(s++,n._loadMore(s,o,t))})})},500)):(clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999))},_loadMore:function(e,t,n){var r=this;this._busy=!0,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),r._searchPeople(n,t,e,r.searchInstanceId,function(){r.showResults(r._contacts.filter(function(e){return!e.hide&&r._matchesQuery(e)})),r.listElScrollEvent&&r.listElScrollEvent.detach(),r.listElScrollEvent=r.listEl.on("scroll",function(){r.listEl._node.clientHeight+r.listEl._node.scrollTop===r.listEl._node.scrollHeight&&(e++,r._loadMore(e,t,n))})})},100)},_nameTest:function(t){var n=new RegExp(".*"+e.flutil.agnosticizeUnicode(t).replace(/\s/,"\\s")+".*","ig");this._matchesQuery=function(e){return n.test(e.username)||n.test(e.realname)||n.test(e.email)}},appendLoader:function(e){e=e||this.listEl;var t=document.createElement("li"),n=e.scrollTop;t.className="loading",t.innerHTML=this.options.loadingState,e.appendChild(t),e.scrollTop=n+t.clientHeight},_searchPeople:function(e,t,n,r,i){var s=this,o,u;s._end=!1,s.options.loadingState&&!s.listEl.one("li.loading")&&s.appendLoader(),o=s.options.appContext.getModel("contacts-models",t),o.then(function(t){return u=t.search({username:e,page:n}),u.then(function(e){var t=e.people,n=s.processContactModels(t,!1,!1);s._contacts=s._contacts||[],s._contacts=s._contacts.concat(n),s._contacts.some(function(e){return s._matchesQuery(e)})||(s._end=!0),i()},function(){s._end=!0,s._busy=!1,i()})},function(){s._end=!0,s._busy=!1,i()})},_isEmail:function(e,t){/,/.test(e)?e=e.split(/,/):e=[e];var n=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(t){while(e.length)if(n.test(e.shift().trim()))return!0;return!1}while(e.length)if(!n.test(e.shift().trim()))return!1;return!0},showResults:function(t){if(this.abort)return;var n=this.options.max||10,r,i,s=this;r=document.createDocumentFragment(),t&&this.selectedIndex>=t.length&&(this.selectedIndex=t.length-1),this.numShowing=Math.min(n,t&&t.length||0),!s._busy&&t&&t.length===0?(i=document.createElement("li"),i.innerHTML='<span class="no-contacts">'+this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"})+"</span>",i.className="no-members",r.appendChild(i),s.highlighted=null):t&&t.slice(0,n).forEach(function(t,n,i){var o=s.createItem(t);n===s.selectedIndex&&(o.setAttribute("class","highlight"),s.highlighted=e.Node(o)),r.appendChild(o)}),(s._busy||!t)&&s.options.loadingState&&s.appendLoader(r),this.options.loadMoreOnScroll&&this.listElScrollEvent&&this.listElScrollEvent.detach(),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(r),this.show()},_template:function(){return['<img src="{{buddyicon}}">','<div class="following-status {{isContact}}">','<span class="following-icon">&nbsp;</span>',"<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>","</div>",'<h2 class="all">{{realname}}</h2>','<h3 class="all">{{username}}</h3>'].join("")},_onlyContactTemplate:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(t){var n=document.createElement("li"),r,i=this.options.searchNonContacts&&this.options.showFollowingState?this._template():this._onlyContactTemplate,s=this.options.truncateLength||70;return r=i.replace(/\{\{(\w+)\}\}/g,function(n,r){if(r==="buddyicon")return t[r];if(r==="isContact")return t[r]?"am-following":"";var i=e.flutil.escapeInput(t[r]);return e.Handlebars.helpers.truncate(i,s)}),n.innerHTML=r,n.dataset?(n.dataset=n.dataset,n.dataset.nsid=t.nsid,n.dataset.displayname=t.realname||t.username,n.dataset.pathAlias=t.pathAlias):(n.setAttribute("data-nsid",t.nsid),n.setAttribute("data-displayname",t.realname||t.username),n.setAttribute("data-path-alias",t.pathAlias)),n}},e.mix(n.prototype,e.Localizable),e.ContactSearchBox=n},"@VERSION@",{requires:["api-helper","flutil","contact-search-css","handlebars-helpers","flickr-contacts-getListfetcher"],langBundles:["common","photo-page-scrappy"]});
YUI.add("fluid-share-panel-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.networkClasses=e.networkClasses,this.linkShareParams=e.linkShareParams,this.guestPassParams=e.guestPassParams||{},this.emailShareParams=e.emailShareParams,this.guestPasses={},this.recipients=[],this},loadState:function(){var t,n=this;return this.emailShareParams&&this.appContext.getViewer().nsid?t=this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){n.set("me",e)}):t=e.Promise.resolve(),t},buildContainer:function(){var e,t;return this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),t={networkClasses:this.networkClasses,linkShareDisplay:this.linkShareDisplay,grabLink:this.linkShareParams.shortURL,canHaveGuestpass:!!this.guestPassParams.type,emailShareParams:this.emailShareParams},this.linkShareDisplay.embedr&&(t.defaultSizeStr=this.linkShareDisplay.embedr.sizes[0].sizeStr,t.defaultEmbedrCode=this.linkShareDisplay.embedr.sizes[0].embedCode),this.linkShareDisplay.bbCode&&(t.defaultBBCode=this.linkShareDisplay.bbCode.sizes[0].embedCode,t.defaultBBCodeSizeStr=this.linkShareDisplay.bbCode.sizes[0].sizeStr),!this.linkShareDisplay.bbCode&&!this.linkShareDisplay.embedr&&(t.hideButtons=!0),e=this.templates("fluid-share-panel")(t),this.setContainerHTML(e),this},activate:function(){var t=this.get("container"),n=t.one(".share-link-types"),r=this,i="embed-code-size-field",s="bb-code-size-field",o={},u=[{text:this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"}),value:"public"},{text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS"}),value:"friends"},{text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY"}),value:"family"},{text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY_AND_FRIENDS"}),value:"family_and_friends"}],a={},f;return this.guestPassParams.canSharePrivate&&u.push({text:this.intlMessage({intlName:"share-modal.SHARE_PRIVATE"}),value:"private"}),o[i]="embed-code-text-field",o[s]="bb-code-text-field",this.linkShareDisplay||(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams)),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n.toggleClass("first-stop",e.target.hasClass("embed-type-button")).toggleClass("second-stop",e.target.hasClass("link-grab-type-button")).toggleClass("third-stop",e.target.hasClass("bbcode-type-button"))},".link-type-button")),this.registerEventHandler(t.delegate("click",function(n){n.preventDefault();var u=n.target.hasClass(i)?i:s,f=u===i?"embedr":"bbCode";if(!a[f]||a[f].isClosed)a[f]=new e.Views.FluidDroparound({appContext:r.appContext,showDropArrow:!0,hideModalOverlay:!0,classList:"over-modal",overlayClassList:"over-modal",mirrorArrowAdjustment:0,preferLeft:!0,anchorElement:t.one("."+u),observePageResize:!0,menuItems:r.linkShareDisplay[f].sizes.map(function(e){return{text:e.sizeStr,value:e.sizeKey}})}),a[f].on("selected",function(e){e&&e.menuItem&&r.linkShareDisplay[f].sizes.some(function(n){return n.sizeKey===e.menuItem.value?(t.one("."+o[u]).set("value",n.embedCode),t.one("."+u).one(".embed-code-label").set("text",n.sizeStr),!0):!1}),a[f].close()}),a[f].show()},".embed-size-field")),this.registerEventHandler(t.delegate("click",function(n){n.preventDefault();if(!f||f.isClosed)f=new e.Views.FluidDroparound({appContext:r.appContext,showDropArrow:!0,hideModalOverlay:!0,classList:"over-modal",overlayClassList:"over-modal",mirrorArrowAdjustment:0,preferLeft:!0,anchorElement:t.one(".grab-link-field"),observePageResize:!0,menuItems:u}),f.on("selected",function(e){if(e&&e.menuItem){var n=e.menuItem.value,i=t.one(".grab-link-text-field");t.one(".grab-link-permission-label").set("text",e.menuItem.text);if(n==="public")i.set("value",r.linkShareParams.shortURL);else{var s=0,o=0,u=0;n==="friends"?s=1:n==="family"&&(o=1),n==="family_and_friends"?(o=1,s=1):n==="private"&&(u=1),r.requestGuestpass(s,o,u).then(function(e){i.set("value",e)},function(e){})}}f.close()}),f.show()},".grab-link-field")),this.registerEventHandler(t.delegate("click",function(e){e.target.ancestor("."+r.networkClasses.flickr,!0)&&(e.preventDefault(),t.one(".share-panels").addClass("show-email-form"))},".share-link")),this.registerEventHandler(t.one(".leave-email-sharing").on("click",function(e){e.preventDefault(),t.one(".share-panels").removeClass("show-email-form")})),this.registerEventHandler(t.one(".share-by-email").on("click",function(e){e.preventDefault(),r.fire("subviewViewEvent","share-by-email",{recipients:r.recipients,message:r.get("container").one(".email-message-text-field").get("value")}),r.recipients=[]})),this.setupEmailSharing(),this},generateLinkSharingDisplay:function(e){var t=this,n={link:e.url},r=e.sizes?Object.keys(e.sizes):[];return r.length>0&&e.supportsEmbedr&&(n.embedr={sizes:Object.keys(e.sizes).map(function(n){return{sizeKey:n,sizeStr:t.getSizeStr(n)+" "+e.sizes[n].width+" \u00d7 "+e.sizes[n].height,embedCode:t.templates("fluid-share-embedr-code")({embedLink:e.url,title:e.title,farmURL:e.sizes[n].src,width:e.sizes[n].width,height:e.sizes[n].height,alt:e.title})}})}),r.length>0&&e.supportsBBCode&&(n.bbCode={sizes:Object.keys(e.sizes).map(function(n){return{sizeKey:n,sizeStr:t.getSizeStr(n)+" "+e.sizes[n].width+" &times; "+e.sizes[n].height,embedCode:t.templates("fluid-share-bb-code")({title:e.title,farmURL:e.sizes[n].src,shortURL:e.shortURL,authorURL:e.authorURL,authorName:e.author})}})}),n},getSizeStr:function(e){var t="";return"sq,q".indexOf(e)>-1?t=this.intlMessage({intlName:"common.SQUARE"}):e==="t"?t=this.intlMessage({intlName:"common.THUMBNAIL"}):"s,n".indexOf(e)>-1?t=this.intlMessage({intlName:"common.SMALL"}):"m,z,c".indexOf(e)>-1?t=this.intlMessage({intlName:"common.MEDIUM"}):"l,h,k".indexOf(e)>-1?t=this.intlMessage({intlName:"common.LARGE"}):e==="o"&&(t=this.intlMessage({intlName:"common.ORIGINAL"})),t},requestGuestpass:function(e,t,n){if(this.guestPasses[""+e+t+n])return this.guestPasses
[""+e+t+n];var r={is_private:n,is_family:e,is_friends:t},i=this,s=this.guestPassParams.type,o=this.guestPassParams.id;return s==="photo"&&(r.photo=o),s==="photostream"&&(r.photostream=o),s==="set"&&(r.set=o),this.appContext.callAPI("flickr.sharing.createGuestpass",r).then(function(r){if(!r||!r.guestpass||!r.guestpass.url)throw new Error("No guestpass returned");var s=r.guestpass.url;return i.guestPasses[""+e+t+n]=s,s},function(e){throw e})},setupEmailSharing:function(){var t=this.get("container"),n=t.one(".email-recipient-text-field"),r="",i=this;this.focus&&(setTimeout(function(){n.focus()},100),this.focus=!1),n&&(this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:n,appContext:this.appContext,shim:"c-contact-search-shim",elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,showFollowingState:!1,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,DOMContainer:t.one(".share-panel-body").getDOMNode(),loadingState:this.templates(e.Balls())(),max:1e3,me:this.get("me"),onError:function(){var e=i.get("container").one(".contact-list-error");n.blur(),i.contacts.hide(),e.hasClass("hidden")&&e.removeClass("hidden")},onShow:function(r){var s=n.ancestor(".c-contact-search-autocomplete");i.arrow||(i.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),i.arrow.inDoc()||s.appendChild(i.arrow),i.arrow.removeClass("hide"),t.addClass("locked-class"),i.fire("subviewViewEvent","make in view",t)},onSelect:function(e){e?t.removeClass("locked"):t.addClass("locked")},onHide:function(){var e=n;i.arrow.addClass("hide"),e.setHTML(r)},onOrientationChange:function(e){i.arrow&&(e?i.arrow.addClass("upside-down"):i.arrow.removeClass("upside-down"))},clickContact:function(t){var r,s,o,u,a;if(e.UA.ie&&document.getSelection()){a=document.getSelection().anchorNode;if(a.id==="content")return}n.removeClass("focused"),i.contacts.abort=!0,i.hideDropdown=setTimeout(function(){i.contacts.hide()},150),r=t.target.ancestor("[data-nsid]",!0);if(!r){i.contacts.hide();return}s=r.getData("nsid"),u=r.one("img").get("src"),o=r.getData("displayname")||"",i.addRecipient(o,s),i.contacts.hideFromSearch(s),i.contacts.hide(),i.contacts.abort=!0}}),this.registerEventHandler(n.on("focus",function(){var t=this;this.addClass("focused"),i.contacts.abort=!1,setTimeout(function(){e.UA.ie&&(t.addClass("focused"),t.focus()),t.set("text","")},40)})),this.registerEventHandler(n.on("keydown",function(e){e.keyCode===13&&(e.halt(),clearTimeout(i.hideDropdown),n.focus())})),this.registerEventHandler(n.on("blur",function(e){this.removeClass("focused")})),this.registerEventHandler(n.ancestor(".c-contact-search-autocomplete").on("focus",function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(i.hideDropdown),n.focus())})))},addRecipient:function(e,t){var n=this.get("container"),r=n.one(".recipient-list");this.recipients.push({name:e,nsid:t}),r.append("<div>"+e+"</div>")}})},"@VERSION@",{requires:["flickr-view","promise","hermes-template-fluid-share-panel","fluid-css","fluid-share-panel-css","fluid-droparound-view","hermes-template-fluid-share-embedr-code","hermes-template-fluid-share-bb-code","fluid-modal-view","contact-search-box"],langBundles:["share-modal","common"]});
YUI.add("hermes-lang-share-modal",function(e,t){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share Photostream"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked for Friends"],SHARE_FAMILY:["Include photos marked for Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked for Family & Friends"],SHARE_PRIVATE:["Include all photos including private photos"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"]})},"@VERSION@",{requires:["intl"]});
YUI.add("fluid-share-view",function(e){var t={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{facebook:"facebook-link",twitter:"twitter-link",tumblr:"tumblr-link",pinterest:"pinterest-link",flickr:"flickr-link"}}};t.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(t.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"http://www.tumblr.com/share/photo?source={{displayPhotoURL}}&caption={{tumblrCaption}}&click_thru={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},"use strict",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerHTML(this.templates("fluid-share")(e)),this},activate:function(){var e=this.get("container"),n=e.one("."+t.css.shareBtn);return n&&this.registerEventHandler(n.on("click",function(e){e.preventDefault(),this.showModal(n)},this)),this},showModal:function(n){var r=this,i=t.css.networkClasses,s=r.getTitleIntlKey(),o={intlName:"share-modal."+s},u;s==="SHARE_PHOTOS_TO"&&(o.count=this.getItemCount()),u=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,showActionButton:!1,hideModalOverlay:!1,showCancelButton:!1,title:r.intlMessage(o),classList:"modal-restyle",subview:new e.Views["fluid-share-panel-view"]({appContext:r.appContext,networkClasses:i,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters()})}),u.registerEventHandler(u.get("container").delegate("click",function(e){e.preventDefault(),e.target.ancestor("."+i.facebook,!0)?r.shareToFacebook(r.prepareFacebookShareParameters()):e.target.ancestor("."+i.twitter,!0)?r.shareToTwitter(r.prepareTwitterShareParameters()):e.target.ancestor("."+i.tumblr,!0)?r.shareToTumblr(r.prepareTumblrShareParameters()):e.target.ancestor("."+i.pinterest,!0)&&r.shareToPinterest(r.preparePinterestShareParameters())},".share-link")),u.on("share-by-email",function(t){var n=e.merge(r.prepareFlickrShareParameters(),t);r.shareToFlickr(n)}),u.show()},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",requiresGuestpass:!1,count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return 1},getGuestPassParams:function(){return{type:null,canSharePrivate:!1,id:null}},shareToFacebook:function(n){if(!n.url)return e.Flog.error("[fluid-share-view] Error sharing to Facebook.  Missing url.");var r,i,s;i=encodeURIComponent(e.url(n.url)),r=t.networks.facebook.shareUrl+i,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:n.count||1}),s=this.createSharePopup(r),this.trackShareCompletion(s)},shareToTwitter:function(n){if(!n.shortURL)return e.Flog.error("[fluid-share-view] Error sharing to Twitter.  Missing shortURL.");if(!n.url)return e.Flog.error("[fluid-share-view] Error sharing to Twitter.  Missing url.");if(!n.title)return e.Flog.error("[fluid-share-view] Error sharing to Twitter.  Missing title.");var r,i,s,o=n.title,u,a=n.shortURL,f;i=encodeURIComponent(e.url(n.url)),f=o+" "+t.networks.twitter.hashTags,f.length+i.length>140&&(u=f.length+i.length-140,f=o.substring(0,o.length-(u+1))+"\u2026"+" "+t.networks.twitter.hashTags),r=t.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(f)).replace("{{linkToShare}}",encodeURIComponent(a)),s=this.createSharePopup(r),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:n.count||1}),this.trackShareCompletion(s)},shareToTumblr:function(n){if(!n.title)return e.Flog.error("[fluid-share-view] Error sharing to Tumblr.  Missing title.");if(!n.displayPhotoURL)return e.Flog.error("[fluid-share-view] Error sharing to Tumblr.  Missing displayPhotoURL.");var r,i=n.title,s,o,u=n.description,a,f=n.displayPhotoURL,l;n.authorURL&&(s=e.url(n.authorURL)),n.ownerName&&(o=n.ownerName),a=encodeURIComponent(e.url(n.url)),r=this.templates("fluid-share-tumblr-post")({title:i,ownerURL:s,ownerName:o,description:u,linkToShare:a}),l=t.networks.tumblr.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(f)).replace("{{tumblrCaption}}",encodeURIComponent(r)).replace("{{linkToShare}}",a),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:n.count||1}),this.createSharePopup(l)},shareToPinterest:function(n){if(!n.title)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing title.");if(!n.displayPhotoURL)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing displayPhotoURL.");if(!n.url)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing url.");if(!n.shortURL)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing shortURL."
);var r,i,s=n.description||"",o=n.shortURL,u=n.title,a=n.displayPhotoURL,f;i=encodeURIComponent(e.url(n.url)),s.trim()!==""?f=o+" | "+u+" | "+s:f=o+" | "+u,r=t.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(a)).replace("{{description}}",encodeURIComponent(f)).replace("{{linkToShare}}",i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:n.count||1}),this.createSharePopup(r)},shareToGooglePlus:function(n){if(!n.url)return e.Flog.error("[fluid-share-view] Error sharing to GooglePlus.  Missing url.");var r,i,s;i=encodeURIComponent(e.url(n.url)),r=t.networks.googlePlus.shareUrl+i,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:n.count||1}),s=this.createSharePopup(r)},shareToFlickr:function(n){if(!n.recipients)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing recipients.");if(!n.message)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing message.");if(!n.url)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing url.");if(!n.modelName)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing modelName.");if(!n.modelId)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing modelId.");var r,i=n.modelName,s=n.modelId,o=n.recipients,u=n.message,a=n.requiresGuestpass,f={},l=[],c=[];r=encodeURIComponent(e.url(n.url)),f[i+"_id"]=s,f.service_type_id="130",f.owner_id=this.appContext.getViewer().nsid,a&&(f.guestpass_private="1");for(var h in o){var p=o[h]||{};p.email?l.push(p.email):p.nsid&&c.push(p.nsid)}f.to_flickr=c.join(","),f.to_email=l.join(","),f.message=e.flutil.escapeInput(u),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:n.count||1}),this.appContext.flickrAPI.callMethod(t.networks.flickr.apiCall,f).then(function(){},function(e){})},trackShareCompletion:function(t){var n=function(r){if(r.source===t)if(r.origin===e.url("/")&&r.data==="Window closed")e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",n,!1);else if(r.origin==="https://twitter.com")try{JSON.parse(r.data).params[0]==="tweet"&&r.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",n,!1))}catch(i){}};e.config.win.addEventListener("message",n,!1)},createSharePopup:function(t){var n={},r="";return n.width=640,n.height=480,n.top=(e.config.win.screen.height-n.height)/2,n.left=(e.config.win.screen.width-n.width)/2,e.Object.each(n,function(e,t){r+=t+"="+e+","}),r=r.slice(0,-1),e.config.win.open(t,"nativeShare",r)}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-css","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","fluid-share-panel-view","flog","url","flutil"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});
YUI.add("fluid-share-photo-view",function(e){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId)]).then(function(e){t.set("photoModel",e[0])})},buildContainer:function(){var e=!!this.get("photoModel").getValue("canShare");return this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:e.getLargestSize({excludeSizes:["o"]}).url,url:e.getValue("url")}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).url,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),modelName:"set",modelId:this.nsid,url:e.getValue("url"),requiresGuestpass:!0,count:1}},prepareLinkShareParameters:function(){var t=this.get("photoModel");return{url:t.getValue("url"),author:t.getValue("owner").getValue("displayname"),authorURL:t.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(t.getValue("id")),supportsEmbedr:!0,supportsBBCode:!0,sizes:t.getValue("sizes"),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"})}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return 1},getGuestPassParams:function(){return{type:"photo",canSharePrivate:!0,id:this.photoId}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:["models","default"]});
YUI.add("products-api-helper",function(e){function s(e,t,n,r){var i,s,o,u,a,f,l,c,h,p;if(t&&!t.isValidCoupon)throw h=new Error(t.invalidReason),h.name="CouponInvalidError",h;return i=r.couponRegistry,s=r.discountRegistry,a=[],e.id=e.couponId,f=e.discounts.discount[0],p=f.discountId,c={costDiscount:f.costDiscount,couponId:e.id,discountType:f.discountType,discountValue:f.discountValue,minPurchaseValue:f.minPurchaseValue,productEntity:f.productEntity},s.exists(p)?(s.setValues(p,c),l=s.proxy(p)):(c.id=p,l=s.add(c)),a.push(l),o={code:e.code,orderId:n,discounts:a},t&&(o.isSingleUse=t.isSingleUse,o.isUserSpecific=t.isUserSpecific,o.isValidCoupon=t.isValidCoupon),i.exists(e.id)?(i.setValues(e.id,o),u=i.proxy(e.id)):(o.id=e.id,u=i.add(o)),u}function o(e,t,n){var r,i,s;return r=n.orderItemRegistry,i=n.itemPriceRegistry,e instanceof Array&&(e=e[0]),e=e.map(function(e){var n=e.renderedProductId,o,u,a,f,l={};return l.sourceProductId=e.sourceProductId,l.productType=e.productType,l.productTitle=e.productTitle,l.quantity=e.quantity,l.cost=e.costProductUnit,l.orderId=t,e.productPrice&&(a=e.productPrice,s={priceBase:a.priceBase,countPagesBase:a.countPagesBase,countPagesExtra:a.countPagesExtra,pricePerPage:a.pricePerPage,pricePagesExtra:a.pricePagesExtra,priceTotal:a.priceTotal},a.shipping&&(f=a.shipping,f.standardShipping&&(s.standardShippingBase=f.standardShipping.priceShippingBase,s.standardShippingExtra=f.standardShipping.priceShippingExtra),f.expressShipping&&(s.expressShippingBase=f.expressShipping.priceShippingBase,s.expressShippingExtra=f.expressShipping.priceShippingExtra)),i.exists(n)?(o=i.proxy(n),o.setValues(s)):(s.id=n,o=i.add(s))),e.product&&e.product.skuId&&(l.skuId=e.product.skuId),l.price=o,r.exists(n)?(u=r.proxy(n),u.setValues(l),u):(l.id=n,r.add(l))}),e}function u(e,t){var n,r,i,s,o;o={},n=t.orderRegistry,e.orderId&&(e.id=e.orderId);if(e.couponMetadata&&!e.couponMetadata.isValidCoupon)throw s=new Error(e.couponMetadata.invalidReason),s.name="CouponInvalidError",s;return e.coupons&&(o.coupon=this.parseCoupons(e.coupons.coupon,e.couponMetadata,e.orderId,t),i=o.coupon.getValue("discounts").getList()[0],i&&i.getValue("discountType")==="percent"&&parseInt(i.getValue("discountValue"),10)===100?o.isFreeOrder=1:o.isFreeOrder=0),e.item&&(o.items=this.parseItems(e.item,e.id,t)),o.orderId=e.orderId,o.statusOrder=e.statusOrder,o.statusPrint=e.statusPrint,o.statusPayment=e.statusPayment,o.paymentMethodId=e.paymentMethodId,o.bookPreviewPdf=e.bookPreviewPdf,o.userId=e.userId,o.trackingNum=e.trackingNum,o.trackingUrl=e.trackingUrl,o.costTotal=parseFloat(e.costTotal)||0,o.costProducts=parseFloat(e.costProducts)||0,o.costShipping=e.costShipping||0,o.costDiscount=e.costDiscount||0,o.costTax=e.costTax,o.isCouponApplied=e.isCouponApplied,o.shippingType=e.shippingType||e.shipMethod||"standard_shipping",o.dateCreate=e.dateCreate,e.countryCode&&(o.countryCode=e.countryCode),n.exists(e.orderId)?(r=n.proxy(e.orderId),r.setValues(o),r):(o.id=e.orderId,n.add(o))}function a(t,n){var r=t,i=n.pageModelRegistry,s=n.bookModelRegistry,o=n.pagePhotoModelRegistry,u=n.photoModelRegistry,a=n.personRegistry,f=n.photoEngagementRegistry,l=n.photoStatsRegistry,c,h=[];if(r)return t={id:r.id,owner:r.owner,title:r.title,coverPhotoId:r.coverPageId,totalPhotos:0,price:r.price,created:r.dateCreate},r.page&&e.Array(r.page).forEach(function(n){var r=[],s;n.photo&&e.Array(n.photo).forEach(function(i){var s,h,p;e.Lang.isNumber(parseInt(i.id,10))&&(n.id=String(n.id).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),p=n.id+"_"+i.position,s={id:p,bookId:t.id,position:i.position,cropX:i.cropX/100,cropY:i.cropY/100,cropW:i.cropW/100,cropH:i.cropH/100,invalidForPrintReason:i.invalidForPrintReason,isInvalidForPrint:i.isInvalidForPrint},h=e.APIHelper.response.parsePhotos({photos:[i],personModelRegistry:a,photoModelRegistry:u,photoEngagementModelRegistry:f,photoStatsModelRegistry:l})[0],s.photo=h,c=s.id,o.exists(c)?(delete s.id,o.setValues(c,s)):o.add(s),r.push(o.proxy(c)))}),s=e.APIHelper.response.parsePage(n),s.bookId=t.id,s.pagePhotos=r,c=s.id,i.exists(c)?(delete s.id,i.setValues(c,s),n=i.proxy(c)):n=i.add(s),h.push(c),t.totalPhotos=t.totalPhotos+r.length,t.coverPage||(t.coverPage=n)}),t.pageOrder=h,s.exists(t.id)?s.setValues(t.id,{title:t.title,pageOrder:t.pageOrder,totalPhotos:t.totalPhotos,coverPage:t.coverPage}):s.add(t),t}var t,n,r,i;t={1:"Flickr Pro",2:"Flickr Pro",3:"Flickr Pro",4:"Ad Free",6:"Ad Free"},n={1:"3 months",2:"1 year",3:"2 years",4:"1 year",6:"1 month"},r={1:"Created",2:"Pending",3:"Submitted",4:"Accepted",5:"Packaged",6:"Shipped",7:"Voided",99:"Cancelled",101:"Submitted"},i={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},e.ProductsAPIHelper={parseOrder:u,parseCoupons:s,parseItems:o,parseBook:a}},"@VERSION@",{requires:[]});
YUI.add("flickr-products-books-editPage-updater",function(e,t){"use strict";function n(n,r){var i={};return i.page_id=n.pageId,i.book_id=n.bookId,n.templateId&&(i.template_id=n.templateId),n.backgroundColor&&(i.background_color=n.backgroundColor),r.callAPI("flickr.products.books.editPage",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-editPage"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-products-books-getPage-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),book_id:t.bookId,page_id:t.id};return t.page=t.page||1,t.perPage=t.perPage||100,n}function r(e,t){var n=e[0],r=e[1],i={id:t.id,photo:[]},s=[],o=!1,u=!1;r.exists(t.id)&&(s=r.getValue(t.id,"photoList").getList(),o=s.hasMinBoundary?s.hasMinBoundary():!1,u=s.hasMaxBoundary?s.hasMaxBoundary():!1),i.pageNumber=n.pageNumber,i.template=parseInt(n.template,10),i.countPhotos=n.countPhotos,i.photo=n.photo,i.backgroundColor=n.backgroundColor,r.exists(t.id)?r.setValue(t.id,"photoList",i.photoList):r.add(i)}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.books.getPage",this._processParams(n)),r.getModelRegistry("page-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-books-getPage"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models"]});
YUI.add("flickr-products-books-setPagePhoto-updater",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=r.page,l=[],c,h;f&&(f.photo&&e.Array(f.photo).forEach(function(t){var r,i,c,p,d;d=f.id+"_"+t.position,r={id:d,bookId:n.bookId,position:t.position,cropX:t.cropX/100,cropY:t.cropY/100,cropW:t.cropW/100,cropH:t.cropH/100,invalidForPrintReason:t.invalidForPrintReason,isInvalidForPrint:t.isInvalidForPrint},i=e.APIHelper.response.parsePhoto(t),c=i.owner,p=i.engagement,h=c.id,u.exists(h)?(delete c.id,u.setValues(h,c)):u.add(c),i.owner=u.proxy(h),h=p.id,a.exists(h)?(delete p.id,a.setValues(h,p)):a.add(p),i.engagement=a.proxy(h),h=i.id,o.exists(h)?(delete i.id,o.setValues(h,i)):o.add(i),r.photo=o.proxy(h),h=r.id,s.exists(h)?(delete r.id,s.setValues(h,r)):s.add(r),l.push(s.proxy(h))}),c=e.APIHelper.response.parsePage(f),c.pagePhotos=l,h=c.id,i.exists(h)?(delete c.id,i.setValues(h,c)):i.add(c))}function r(r,i){var s={};return s.page_id=r.pageId,s.book_id=r.bookId,s.position=r.position,s.photo_id=r.photoId,s.crop_x=Math.round(Math.abs(r.cropX*100)),s.crop_y=Math.round(Math.abs(r.cropY*100)),s.crop_w=Math.round(Math.abs(r.cropW*100)),s.crop_h=Math.round(Math.abs(r.cropH*100)),s.extras=e.APIHelper.request.getRebootPhotoExtras(),e.Promise.all([i.callAPI("flickr.products.books.setPagePhoto",s),i.getModelRegistry("page-models"),i.getModelRegistry("book-page-photo-models"),i.getModelRegistry("photo-models"),i.getModelRegistry("person-models"),i.getModelRegistry("photo-engagement-models")]).then(function(e){return n(e,r)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-setPagePhoto"]={run:r}},"@VERSION@",{requires:["flickr-promise"],optional:["page-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("book-page-photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(e){},create:function(t){return e.ModelUpdaters["flickr-products-books-setPagePhoto"].run({create:!0,pageId:t.pageId,bookId:t.bookId,position:1,photoId:t.photoId,template:2,cropX:0,cropY:0,cropW:0,cropH:0},this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)}},attributes:{bookId:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photo:{isModel:!0},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},position:{defaultFn:function(){return 1},getter:function(e){return parseInt(e,10)||1},defaultValue:1},isLowQuality:{defaultFn:function(){return 0}},invalidForPrintReason:{},isInvalidForPrint:{defaultFn:function(){return 0}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-setPagePhoto-updater"]});
YUI.add("flickr-products-books-updateBook-updater",function(e,t){"use strict";function n(t,n){return e.batch(n.getModel("book-models",t),n.getModelRegistry("page-models")).then(function(e){var t,r={},i,s=e[0],o=e[1];return t={id:""+s.id,owner:n.getViewer().nsid,title:s.getValue("title")},i=s.getValue("pageOrder"),t.count_pages=i.length-1,i.forEach(function(e,t){var n,i={},s,u;s=o.proxy(e),n={id:s.id,page_number:s.getValue("pageNumber")+"",count_photos:s.getValue("countPhotos")+"",template:s.getValue("template")+"",background_color:s.getValue("backgroundColor")},u=s.getValue("pagePhotos").getList(),u=u.forEach(function(e,t){var n;e.getValue("photo")&&(n={id:e.getValue("photo").id,position:t+1+"",crop_x:e.getValue("cropX")*100+"",crop_y:e.getValue("cropY")*100+"",crop_w:e.getValue("cropW")*100+"",crop_h:e.getValue("cropH")*100+"",low_quality:e.getValue("isLowQuality"),is_invalid_for_print:e.getValue("isInvalidForPrint")},i[t+1]=n)}),n.photos=i,r[t]=n}),t.pages=r,t})}function r(n,r,i){var s=this;return this.serialize(n,r).then(function(i){return r.callAPI("flickr.products.books.updateBook",{book:JSON.stringify(i)}).then(function(t){if(t[0]&&t[0].badPhotos)e.fire("bookUpdater:failure",{badPhotos:t[0].badPhotos});else if(s.pendingUpdate)return s.pendingUpdate=!1,s.startNextUpdate(n,r)},function(e){throw s.pendingUpdate&&(s.pendingUpdate=!1),e}).then(null,e.FetcherErrorLogger(t))})}function i(){return this.updateInFlight=null,!0}function s(e,t){return this.updateInFlight=this.callAPI(e,t).then(this.clearUpdateInFlight.bind(this),this.clearUpdateInFlight.bind(this)),this.updateInFlight}function o(e,t){return this.pendingUpdate=null,this.startUpdate(e,t)}function u(e,t){var n=e.bookId;return this.pendingUpdate?this.updateInFlight:this.updateInFlight?(this.pendingUpdate=!0,this.updateInFlight):this.startUpdate(n,t)}e.namespace("ModelUpdaters")["flickr-products-books-updateBook"]={run:u,serialize:n,callAPI:r,clearUpdateInFlight:i,startUpdate:s,startNextUpdate:o}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["page-models","book-models","book-page-photo-models"]});
YUI.add("api-products-books-helper",function(e){function t(t,n,r,i){var s=t.book,o,u,a=[];s&&(u={id:s.id,owner:s.owner,title:s.title,coverPhotoId:s.coverPhotoId},s.page&&e.Array(s.page).forEach(function(t){n.exists(t.id)?o=e.APIHelper.response.parsePage(t):n.add(e.APIHelper.response.parsePage(t)),a.push(n.proxy(t.id))}),u.pages=a,r.exists(u.id)?r.setValues(u.id,{title:u.title,pages:u.pages,coverPhotoId:u.coverPhotoId}):r.add(u))}e.APIProductsBooksHelper={processDefaultResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper","api-products-books-helper"],optional:["page-models","book-models"]});
YUI.add("flickr-products-books-editBook-updater",function(e,t){"use strict";function n(n,r){var i={};return i.book_id=n.bookId,i.title=n.title,e.Promise.all([r.callAPI("flickr.products.books.editBook",i),r.getModelRegistry("book-models")]).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-editBook"]={run:n}},"@VERSION@",{requires:["flickr-promise","api-helper","api-products-books-helper"],optional:["page-models","book-models"]});
YUI.add("flickr-products-books-creator",function(e,t){"use strict";function n(t){var n={};return t=t||{},n=t,n.cacheBust=Date.now(),n.extras=e.APIHelper.request.getRebootPhotoExtras(),n}function r(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.books.create",this._processParams(n)),pageModelRegistry:r.getModelRegistry("page-models"),bookModelRegistry:r.getModelRegistry("book-models"),pagePhotoModelRegistry:r.getModelRegistry("book-page-photo-models"),photoModelRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models")})).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-products-books-creator"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books"].run(t,this.appContext)},update:function(t,n){return"title"in n?e.ModelUpdaters["flickr-products-books-editBook"].run({bookId:t,title:n.title.newVal},this.appContext):e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:t},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-creator"].run(t,this.appContext)}},movePage:function(e,t,n,r){var i,s,o,u;return i=this.getValue(e,"pageOrder"),s=i.length,t<s&&n<s&&(r?u=i.splice(t,2):u=i.splice(t,1)[0],o=[n,0].concat(u),Array.prototype.splice.apply(i,o)),this.setValue(e,"pageOrder",i),i},addPage:function(e,t,n){var r,i;return r=this.getValue(e,"pageOrder"),i=r.length,n<=i&&r.splice(n+1,0,t),this.setValue(e,"pageOrder",r),r},removePage:function(e,t){var n,r,i,s;return n=this.getValue(e,"pageOrder"),s=n.length,r=n.indexOf(t),r<s&&(i=n.splice(r,1),this.setValue(e,"pageOrder",n)),n},attributes:{title:{},owner:{},pageOrder:{},coverPage:{isModel:!0},totalPhotos:{},price:{},lastPageViewed:{},created:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater","flickr-products-books-creator"]});
YUI.add("flickr-products-books-addPage-creator",function(e,t){"use strict";function n(t){var n={book_id:t.bookId};return t.photoIds&&(n.photo_ids=t.photoIds.join(","),n.extras=e.APIHelper.request.getRebootPhotoExtras()),e.Lang.isNumber(t.templateId)&&(n.template_id=t.templateId),t.backgroundColor&&(n.background_color=t.backgroundColor),n}function r(t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=t[4],f=t[5],l=t[6],c=[],h,p=i.page,d,v;return p.photo&&e.Array(p.photo).forEach(function(t){var r,i,s,f,h;h=p.id+"_"+t.position,r={id:h,bookId:n.bookId,position:t.position,cropX:t.cropX/100,cropY:t.cropY/100,cropW:t.cropW/100,cropH:t.cropH/100,invalidForPrintReason:t.invalidForPrintReason,isInvalidForPrint:t.isInvalidForPrint},i=e.APIHelper.response.parsePhoto(t),s=i.owner,f=i.engagement,d=s.id,a.exists(d)?(delete s.id,a.setValues(d,s)):a.add(s),i.owner=a.proxy(d),d=f.id,l.exists(d)?(delete f.id,l.setValues(d,f)):l.add(f),i.engagement=l.proxy(d),d=i.id,u.exists(d)?(delete i.id,u.setValues(d,i)):u.add(i),r.photo=u.proxy(d),d=r.id,o.exists(d)?(delete r.id,o.setValues(d,r)):o.add(r),c.push(o.proxy(d))}),v=e.APIHelper.response.parsePage(p),v.pagePhotos=c,v.bookId=n.bookId,d=v.id,s.exists(d)?(delete v.id,s.setValues(d,v),h=s.proxy(d)):h=s.add(v),f.proxy(n.bookId).getValue("pages").appendToList(h),h}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.books.addPage",this._processParams(n)),r.getModelRegistry("page-models"),r.getModelRegistry("book-page-photo-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("book-models"),r.getModelRegistry("photo-engagement-models")]).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-products-books-addPage"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("flickr-products-books-removePage-deletor",function(e,t){"use strict";function n(e,t){var n=e[1],r=e[0],i=n.book,s;i&&(s={id:i.id,price:i.price},r.exists(s.id)&&r.setValues(s.id,{price:s.price}))}function r(n,r,i){var s={},o=this;return s.page_id=n,s.book_id=r,e.Promise.all([i.getModelRegistry("book-models"),i.callAPI("flickr.products.books.removePage",s)]).then(function(e){return o._processResponse(e)},e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-products-books-removePage"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("page-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books-getPage"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-addPage"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-products-books-removePage"].run(t,this.getValue(t,"bookId"),this.appContext)}},forceUpdate:function(t){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},attributes:{bookId:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},backgroundColor:{defaultValue:"255,255,255"},pageNumber:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},template:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotos:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},pagePhotos:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-products-books-editPage-updater","flickr-products-books-getPage-fetcher","flickr-products-books-addPage-creator","flickr-products-books-removePage-deletor","flickr-model-registry","flickr-promise"]});
YUI.add("flickr-products-books-fetcher",function(e,t){"use strict";function n(t){t.page=t.page||1,t.perPage=t.perPage||100;var n={book_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.books.getBook",this._processParams(n)),pageModelRegistry:r.getModelRegistry("page-models"),bookModelRegistry:r.getModelRegistry("book-models"),pagePhotoModelRegistry:r.getModelRegistry("book-page-photo-models"),photoModelRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models")})).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-books"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("basic-book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{title:{},owner:{},coverPhoto:{isModel:!0},coverPhotoDeleted:{defaultFn:function(){return!1}},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},totalPages:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater"]});
YUI.add("flickr-creations-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=[],p=[],d=[];return r&&r.stat==="ok"&&(h=Object.keys(r.wallart_ids).map(function(e){return r.wallart_ids[e]}),e.Array.each(h,function(t,r){if(t.photoSource===2)return;var i,s,u,h,d=[],v=!1,m,g,y,b={};s=a.exists(n.id)?a.proxy(n.id):a.add({id:t.owner}),t.photo.id?(b={photos:[t.photo],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c},t.photo.ownerId&&(b.ownerID=t.photo.ownerId),u=e.APIHelper.response.parsePhotos(b)[0]):v=!0,t.orders&&typeof t.orders=="object"&&(h=Object.keys(t.orders).map(function(e){return t.orders[e]}),e.Array.each(h,function(e){d.push({orderId:e.orderId,orderStatus:e.order.statusOrder,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate})})),t.skuId.substr(-2)==="CC"?(m=t.skuId.slice(0,-3),g=!0):t.skuId.substr(-2)==="MK"?(m=t.skuId.slice(0,-3),y=!0):m=t.skuId,i=o.exists(t.wallartId)?o.proxy(t.wallartId):o.add({id:t.wallartId,owner:s,photo:u,photoDeleted:v,skuId:m,isCC:g,isMK:y,orientation:t.orientation,price:t.price,cropW:t.photo.cropW,cropH:t.photo.cropH,cropX:t.photo.cropX,cropY:t.photo.cropY,isEditable:t.isEditable,isLowQuality:t.isLowQuality,created:t.dateCreate,updated:t.dateUpdate,orders:d,photoSource:t.photoSource}),p.push(i)})),i&&i.stat==="ok"&&e.Array.each(i.books.book,function(t,r){var i,s=!1,o,h;o=a.exists(n.id)?a.proxy(n.id):a.add({id:t.owner}),t.coverPhoto.id?h=e.APIHelper.response.parsePhotos({photos:[t.coverPhoto],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c})[0]:s=!0,i=u.exists(t.id)?u.proxy(t.id):u.add({id:t.id,title:t.title,owner:o,coverPhoto:h,coverPhotoDeleted:s,totalPages:t.countPages,created:t.dateCreate,updated:t.dateUpdate,cropW:t.coverPhoto.cropW/100,cropH:t.coverPhoto.cropH/100,cropX:t.coverPhoto.cropX/100,cropY:t.coverPhoto.cropY/100}),d.push(i)}),s.exists(n.id)||s.add({id:n.id,wallarts:p,books:d}),{wallarts:p,books:d}}function i(n,r){var i=this,s=this._processParams(n);return e.Promise.all([r.callAPI("flickr.products.wallart.getList",s,!0),r.callAPI("flickr.products.books.getList",s,!0),r.getModelRegistry("creations-models"),r.getModelRegistry("wallart-models"),r.getModelRegistry("basic-book-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-creations"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["creations-models","wallart-models","basic-book-models","person-models","photo-models","photo-engagement-models","photo-stats-models"]});
YUI.add("creations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-creations"].run(t,this.appContext)}},removeCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").remove(e)}),n.books&&e.Array.each(n.books,function(e,n){r.getValue(t,"books").remove(e)})},appendCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").unshift(e)})},attributes:{wallarts:{isCollection:!0},books:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-promise","model-proxy","flickr-model-registry","flickr-creations-fetcher"],optional:["wallart-models","basic-book-models"]});
